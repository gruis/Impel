<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/* 
<span class='line'>  2</span>   Copyright (c) 2009 Caleb Crane &lt;license [at] simulacre.org>, Simulacre Publishing LLC
<span class='line'>  3</span> 
<span class='line'>  4</span>   Permission is hereby granted, free of charge, to any person
<span class='line'>  5</span>   obtaining a copy of this software and associated documentation
<span class='line'>  6</span>   files (the "Software"), to deal in the Software without
<span class='line'>  7</span>   restriction, including without limitation the rights to use,
<span class='line'>  8</span>   copy, modify, merge, publish, distribute, sublicense, and/or sell
<span class='line'>  9</span>   copies of the Software, and to permit persons to whom the
<span class='line'> 10</span>   Software is furnished to do so, subject to the following
<span class='line'> 11</span>   conditions:
<span class='line'> 12</span> 
<span class='line'> 13</span>   The above copyright notice and this permission notice shall be
<span class='line'> 14</span>   included in all copies or substantial portions of the Software.
<span class='line'> 15</span>   
<span class='line'> 16</span>   Except as contained in this notice, the name(s) of the above 
<span class='line'> 17</span>   copyright holders shall not be used in advertising or otherwise 
<span class='line'> 18</span>   to promote the sale, use or other dealings in this Software 
<span class='line'> 19</span>   without prior written authorization.
<span class='line'> 20</span>   
<span class='line'> 21</span>   The end-user documentation included with the redistribution, if 
<span class='line'> 22</span>   any, must include the following acknowledgment: "This product 
<span class='line'> 23</span>   includes software developed by Simulacre Publishing LLC 
<span class='line'> 24</span>   (http://www.simulacre.org/) and its contributors", in the same 
<span class='line'> 25</span>   place and form as other third-party acknowledgments. Alternately, 
<span class='line'> 26</span>   this acknowledgment may appear in the software itself, in the same
<span class='line'> 27</span>   form and location as other such third-party acknowledgments.
<span class='line'> 28</span> 
<span class='line'> 29</span>   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
<span class='line'> 30</span>   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
<span class='line'> 31</span>   OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
<span class='line'> 32</span>   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
<span class='line'> 33</span>   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
<span class='line'> 34</span>   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
<span class='line'> 35</span>   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
<span class='line'> 36</span>   OTHER DEALINGS IN THE SOFTWARE.
<span class='line'> 37</span> */</span><span class="WHIT">
<span class='line'> 38</span> 
<span class='line'> 39</span> 
<span class='line'> 40</span> 
<span class='line'> 41</span> 
<span class='line'> 42</span> </span><span class="COMM">/**
<span class='line'> 43</span>  * An extension to the String Native
<span class='line'> 44</span>  * @memberOf String
<span class='line'> 45</span>  * @class String
<span class='line'> 46</span>  */</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="NAME">String.implement</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 48</span> 
<span class='line'> 49</span> </span><span class="COMM">/**
<span class='line'> 50</span>  * Parse a Peer::column string into its constituent parts
<span class='line'> 51</span>  * @returns {Object} containing the name of the Peer class, associated table column, associated column, associated get method, associated set method, and the original string as well as a reference to the associated ImpelPeer object.
<span class='line'> 52</span>  *
<span class='line'> 53</span>  * @example
<span class='line'> 54</span>  *  "CardPeer::name".parsePeerColumn();
<span class='line'> 55</span>  *
<span class='line'> 56</span>  *  will return:
<span class='line'> 57</span>  *    { peer          : a CardPeer object reference, 
<span class='line'> 58</span>  *      peer_name     : "CardPeer", 
<span class='line'> 59</span>  *      column        : "name", 
<span class='line'> 60</span>  *      table_column  : "card.name", 
<span class='line'> 61</span>  *      getter        : "getName", 
<span class='line'> 62</span>  *      setter        : "setName", 
<span class='line'> 63</span>  *      orig          : "CardPeer::name" }
<span class='line'> 64</span>  *
<span class='line'> 65</span>  * @memberOf String
<span class='line'> 66</span>  */</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="WHIT"> </span><span class="NAME">parsePeerColumn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">   </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.contains</span><span class="PUNC">(</span><span class="STRN">'::'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">     </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">'Peer Column ('</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">+</span><span class="STRN">') is not properly formatted, e.g., Peer::Column'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT">   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">peer_name</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.split</span><span class="PUNC">(</span><span class="STRN">'::'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.split</span><span class="PUNC">(</span><span class="STRN">'::'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 72</span> 
<span class='line'> 73</span> </span><span class="WHIT">   </span><span class="KEYW">try</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">     </span><span class="PUNC">{</span><span class="WHIT">  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">peer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">peer_name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 75</span> </span><span class="WHIT">   </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 76</span> </span><span class="WHIT">     </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Peer Class ("</span><span class="PUNC">+</span><span class="NAME">peer_name</span><span class="PUNC">+</span><span class="STRN">") is undefined: "</span><span class="PUNC">+</span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 77</span> 
<span class='line'> 78</span> </span><span class="WHIT">   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">table_column</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer.getColumns</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NAME">column</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">   </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">table_column</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">     </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"Peer Class "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">+</span><span class="STRN">" not found"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 81</span> 
<span class='line'> 82</span> </span><span class="WHIT">   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">camelized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">   </span><span class="NAME">column.replace</span><span class="PUNC">(</span><span class="REGX">/_/g</span><span class="PUNC">,</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">camelCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">ucfirst</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 83</span> </span><span class="WHIT">   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'get'</span><span class="PUNC">+</span><span class="NAME">camelized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 84</span> </span><span class="WHIT">   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">setter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'set'</span><span class="PUNC">+</span><span class="NAME">camelized</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 85</span> </span><span class="WHIT">   </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">"peer"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">peer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"peer_name"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">peer_name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"column"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"table_column"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">table_column</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'getter'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">getter</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'setter'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">setter</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'orig'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 86</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 87</span> </span><span class="WHIT"> </span><span class="COMM">/** 
<span class='line'> 88</span>   * Make the first character of this String lower case 
<span class='line'> 89</span>   * @method lcfirst
<span class='line'> 90</span>   * @memberOf String
<span class='line'> 91</span>   */</span><span class="WHIT">
<span class='line'> 92</span> </span><span class="WHIT"> </span><span class="NAME">lcfirst</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 93</span> </span><span class="WHIT">   </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.substr</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT"> </span><span class="COMM">/** 
<span class='line'> 96</span>   * Capitalize the first character of this String 
<span class='line'> 97</span>   * @method ucfirst
<span class='line'> 98</span>   * @memberOf String
<span class='line'> 99</span>   */</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT"> </span><span class="NAME">ucfirst</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">   </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.substr</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>103</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>104</span> 
<span class='line'>105</span> 
<span class='line'>106</span> </span><span class="COMM">/**
<span class='line'>107</span>  * &lt;p>Impel is a Javascript to HTML 5 Object Relational Mapping Library&lt;/p>
<span class='line'>108</span>  *  
<span class='line'>109</span>  *  &lt;h2>Issues&lt;/h2>
<span class='line'>110</span>  *  &lt;ul>
<span class='line'>111</span>  *   &lt;li>It is very likely that more than two connected left joins e.g., a LEFT JOIN b LEFT JOIN c LEFT JOIN d, will result in incorrect SQL&lt;/li>
<span class='line'>112</span>  *   &lt;li>There is no clear definition as to when a transaction should be rolled back&lt;/li>
<span class='line'>113</span>  *   &lt;li>Peers and Classes must be within the top level of the window, e.g., window[AbcPeer]&lt;/li>
<span class='line'>114</span>  *   &lt;li>It is assumed that each object and each table contains an attribute/column named id that is the PRIMARY KEY  and it is AUTO INCREMENT&lt;/li>
<span class='line'>115</span>  *   &lt;li>Auto generated created_at column value can be overridden, but updated_at cannot&lt;/li>
<span class='line'>116</span>  *   &lt;/ul>
<span class='line'>117</span>  * 
<span class='line'>118</span>  *  &lt;h2>Missing Features&lt;/h2>
<span class='line'>119</span>  *  &lt;ul>
<span class='line'>120</span>  *   &lt;li>It is not possible to call save once on an array of objects and have them all saved at once.&lt;/li>
<span class='line'>121</span>  *   &lt;li>An API that exactly mirrors PHP's Propel&lt;/li>
<span class='line'>122</span>  *   &lt;li>Auto create of database and SQL tables&lt;/li>
<span class='line'>123</span>  *  &lt;/ul>
<span class='line'>124</span>  *
<span class='line'>125</span>  *
<span class='line'>126</span>  *
<span class='line'>127</span>  * &lt;h2>Using Impel&lt;/h2>
<span class='line'>128</span>  * &lt;p>Impel is a ....&lt;/p>
<span class='line'>129</span>  * &lt;p>Impel makes it easy to ... &lt;/p>
<span class='line'>130</span>  * &lt;h3>Define the model&lt;/h3>
<span class='line'>131</span>  * &lt;pre class="code brush: js;">
<span class='line'>132</span>  *   var Card = new Class({
<span class='line'>133</span>  *         Extends    : ImpelClass,
<span class='line'>134</span>  *         peer_class : "CardPeer",
<span class='line'>135</span>  *         toString   : function(){
<span class='line'>136</span>  *                        return this.getName() + " of " + this.getSuit();
<span class='line'>137</span>  *                      }
<span class='line'>138</span>  *     });
<span class='line'>139</span>  *
<span class='line'>140</span>  *   var CardPeer = new ImpelPeer({
<span class='line'>141</span>  *          'columns'      : { 'id'    : 'card.id',    'suit' : 'card.suit', 
<span class='line'>142</span>                             'value' : 'card.value', 'name' : 'card.name'},
<span class='line'>143</span>  *          'table'        : 'card',
<span class='line'>144</span>  *          'base_object'  : 'Card'
<span class='line'>145</span>  *     });
<span class='line'>146</span>  *
<span class='line'>147</span>  *  var Stack = new Class({
<span class='line'>148</span>  *       Extends      : ImpelClass,
<span class='line'>149</span>  *       peer_class   : "StackPeer",
<span class='line'>150</span>  *       toString     : function(){
<span class='line'>151</span>  *                        return this.getName();
<span class='line'>152</span>  *                      }
<span class='line'>153</span>  *     });
<span class='line'>154</span>  *
<span class='line'>155</span>  *   var StackPeer = new ImpelPeer({
<span class='line'>156</span>  *         'columns'      : { 'id'          : 'stack.id',         'name'       : 'stack.name', 
<span class='line'>157</span>  *                            'created_at'  : 'stack.created_at', 'updated_at' : 'stack.updated_at'},
<span class='line'>158</span>  *         'table'        : 'stack',
<span class='line'>159</span>  *         'base_object'  :  'Stack'
<span class='line'>160</span>  *     });
<span class='line'>161</span>  *
<span class='line'>162</span>  *   var CardStack = new Class({
<span class='line'>163</span>  *        Extends: ImpelClass,
<span class='line'>164</span>  *        peer_class: "CardStackPeer",
<span class='line'>165</span>  *        toString: function(){
<span class='line'>166</span>  *          return this.getId() + ":" + this.getCardId() + "-" + this.getStackId();
<span class='line'>167</span>  *        }
<span class='line'>168</span>  *      });
<span class='line'>169</span>  *
<span class='line'>170</span>  *   var CardStackPeer = new ImpelPeer({
<span class='line'>171</span>  *           'columns'      : {'id' : 'card_stack.id', 'stack_id'  : 'card_stack.stack_id', 
<span class='line'>172</span>  *                                                     'card_id'   : 'card_stack.card_id'},
<span class='line'>173</span>  *           'table'        : 'card_stack',
<span class='line'>174</span>  *           'base_object'  : 'CardStack'
<span class='line'>175</span>  *      });
<span class='line'>176</span>  * &lt;/pre>
<span class='line'>177</span>  * &lt;h3>Define the relationships between the classes&lt;/h3>
<span class='line'>178</span>  * &lt;pre class="code brush: js;">
<span class='line'>179</span>  *     CardPeer.hasManyThrough("StackPeer::id","CardStackPeer::card_id","CardStackPeer::stack_id");
<span class='line'>180</span>  *     StackPeer.hasManyThrough("CardPeer::id","CardStackPeer::stack_id","CardStackPeer::card_id");
<span class='line'>181</span>  * &lt;/pre>
<span class='line'>182</span>  *
<span class='line'>183</span>  * &lt;h3>Use the objects in your code&lt;/h3>
<span class='line'>184</span>  * Instantiate the objects as you normally would and use the automatically
<span class='line'>185</span>  * created get and set methods to access the attributes of the objects.
<span class='line'>186</span>  *
<span class='line'>187</span>  * &lt;pre class="code brush: js;">
<span class='line'>188</span>  *  var cards  = [];
<span class='line'>189</span>  *
<span class='line'>190</span>  *  cards[0]   = new Card();
<span class='line'>191</span>  *    cards[0].setSuit("hearts");
<span class='line'>192</span>  *    cards[0].setName("9");
<span class='line'>193</span>  *    cards[0].setValue(9);
<span class='line'>194</span>  *
<span class='line'>195</span>  *  cards[1]   = new Card();
<span class='line'>196</span>  *    cards[1].setSuit("hearts");
<span class='line'>197</span>  *    cards[1].setName("10");
<span class='line'>198</span>  *    cards[1].setValue(10);
<span class='line'>199</span>  *
<span class='line'>200</span>  *  cards[2]   = new Card();
<span class='line'>201</span>  *    cards[2].setSuit("hearts");
<span class='line'>202</span>  *    cards[2].setName("Jack");
<span class='line'>203</span>  *    cards[2].setValue(11);
<span class='line'>204</span>  *
<span class='line'>205</span>  *  cards[3]   = new Card();
<span class='line'>206</span>  *    cards[3].setSuit("hearts");
<span class='line'>207</span>  *    cards[3].setName("Queen");
<span class='line'>208</span>  *    cards[3].setValue(12);
<span class='line'>209</span>  *
<span class='line'>210</span>  *  cards[4]   = new Card();
<span class='line'>211</span>  *    cards[4].setSuit("hearts");
<span class='line'>212</span>  *    cards[4].setName("King");
<span class='line'>213</span>  *    cards[4].setValue(13);
<span class='line'>214</span>  *
<span class='line'>215</span>  *  var sFlush   = new Stack();
<span class='line'>216</span>  *        sFlush.setName('Straight Flush');
<span class='line'>217</span>  * &lt;/pre>
<span class='line'>218</span>  *
<span class='line'>219</span>  * &lt;h3>Associate objects with one another &lt;/h3>    
<span class='line'>220</span>  * Objects that are related to one another through one-to-many and 
<span class='line'>221</span>  * many-to-many relationships use automatically generated add and get 
<span class='line'>222</span>  * methods rather than set and get methods
<span class='line'>223</span>  *
<span class='line'>224</span>  * &lt;pre class="code brush: js;">
<span class='line'>225</span>  *    sFlush.addCard(cards[0]);
<span class='line'>226</span>  *    sFlush.addCard(cards[1]);
<span class='line'>227</span>  *    sFlush.addCard(cards[2]);
<span class='line'>228</span>  *    sFlush.addCard(cards[3]);
<span class='line'>229</span>  *    sFlush.addCard(cards[4]);
<span class='line'>230</span>  * &lt;/pre>
<span class='line'>231</span>  *
<span class='line'>232</span>  * &lt;h3>Persist objects via the HTML 5 database&lt;/h3>
<span class='line'>233</span>  * If objects are associated with one another you only need to call save 
<span class='line'>234</span>  * on one of them. Impel will automatially save any related objects. Impel 
<span class='line'>235</span>  * is also smart enough to figure out when an UPDATE is required instead 
<span class='line'>236</span>  * of an INSERT.
<span class='line'>237</span>  *
<span class='line'>238</span>  * The HTML 5 specification requires that the HTML database be asynchronous, 
<span class='line'>239</span>  * so Impel is as well. When you call save on an object nothing will be 
<span class='line'>240</span>  * returned, but a callbacks will be used to signal if the save was 
<span class='line'>241</span>  * successful or not. You can safely call save without a callback if you like.
<span class='line'>242</span>  *
<span class='line'>243</span>  * &lt;pre class="code brush: js;">
<span class='line'>244</span>  *  sFlush.save(
<span class='line'>245</span>  *    function(){ 
<span class='line'>246</span>  *      notify.show("Saved "+sFlush.getName() + " with " + sFlush.getCards().length + " cards.");
<span class='line'>247</span>  *    },
<span class='line'>248</span>  *    function(error){ 
<span class='line'>249</span>  *      notify.error("Failed to save "+sFlush.getName() + " with " + 
<span class='line'>250</span>                       sFlush.getCards().length + " cards." + error);
<span class='line'>251</span>  *    }
<span class='line'>252</span>  *  );
<span class='line'>253</span>  * &lt;/pre>
<span class='line'>254</span>  * &lt;h3>Retrieve objects from the HTML 5 database&lt;/h3>
<span class='line'>255</span>  * To retrieve specific objects from the database first instantiate a Criteria
<span class='line'>256</span>  * object and use it to define exactly which object you want to retrieve. Then
<span class='line'>257</span>  * use that objects associated ImpelPeer to retrieve it.
<span class='line'>258</span>  *
<span class='line'>259</span>  * &lt;pre class="code brush: js;">
<span class='line'>260</span>  *  var c = new Criteria();
<span class='line'>261</span>  *     c.add("StackPeer::name","Straight Flush");
<span class='line'>262</span>  *  CardPeer.doSelectJoinAll(c, function(cards){ 
<span class='line'>263</span>  *                                  cards.each(function(card){
<span class='line'>264</span>  *                                      display(card);
<span class='line'>265</span>  *                                  });
<span class='line'>266</span>  *                              });
<span class='line'>267</span>  * &lt;/pre>
<span class='line'>268</span>  *
<span class='line'>269</span>  * @see ImpelClass#save
<span class='line'>270</span>  * @see ImpelPeer#doSelectJoinAll
<span class='line'>271</span>  * @see ImpelPeer#doSelectOneJoinAll
<span class='line'>272</span>  * @see ImpelPeer#doSelect
<span class='line'>273</span>  * @see ImpelPeer#doSelectJoinAllExcept
<span class='line'>274</span>  * @see ImpelPeer#hasMany
<span class='line'>275</span>  * @see ImpelPeer#hasManyThrough
<span class='line'>276</span>  *
<span class='line'>277</span>  * @class Impel
<span class='line'>278</span>  * @property {database} db The HTML 5 SQL database to execute queries against
<span class='line'>279</span>  *
<span class='line'>280</span>  * @requires MooTools
<span class='line'>281</span>  * @author Caleb Crane - Simulacre Publishing LLC
<span class='line'>282</span>  * @version 2009 Alpha 0
<span class='line'>283</span>  */</span><span class="WHIT">
<span class='line'>284</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Impel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">  </span><span class="NAME">Implements</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">Options</span><span class="PUNC">,</span><span class="NAME">Events</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">  </span><span class="NAME">db</span><span class="WHIT">          </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">  </span><span class="NAME">peers</span><span class="WHIT">       </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">  </span><span class="NAME">options</span><span class="WHIT">     </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">    </span><span class="NAME">dbName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"impel"</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>290</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>292</span> </span><span class="WHIT">  </span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>293</span> </span><span class="WHIT">    
<span class='line'>294</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>295</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">  </span><span class="NAME">createDB</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">    
<span class='line'>298</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">  </span><span class="NAME">addPeer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">    
<span class='line'>302</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">  </span><span class="NAME">createTables</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">    
<span class='line'>306</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">  </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">  </span><span class="NAME">importData</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">    
<span class='line'>310</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>311</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>312</span> 
<span class='line'>313</span> 
<span class='line'>314</span> 
<span class='line'>315</span> 
<span class='line'>316</span> 
<span class='line'>317</span> 
<span class='line'>318</span> 
<span class='line'>319</span> 
<span class='line'>320</span> </span><span class="COMM">/**
<span class='line'>321</span>  * A simplified verion of the SQLResultSet class that can be easily turned into an array
<span class='line'>322</span>  * @class ResultSet
<span class='line'>323</span>  */</span><span class="WHIT">
<span class='line'>324</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ResultSet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>325</span> </span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>327</span>   * The blah blah
<span class='line'>328</span>   * @param {SQLResultSet} rs A result set as returned from an HTML 5 database SELECT statement
<span class='line'>329</span>   */</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT"> </span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>331</span> </span><span class="WHIT">   </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">rs.rows.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">       </span><span class="NAME">this.results.push</span><span class="PUNC">(</span><span class="NAME">rs.rows.item</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>336</span>   * Convert the result set into an array
<span class='line'>337</span>   * @method toArray
<span class='line'>338</span>   * @return array
<span class='line'>339</span>   */</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT"> </span><span class="NAME">toArray</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">   </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>343</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>344</span> 
<span class='line'>345</span> 
<span class='line'>346</span> 
<span class='line'>347</span> 
<span class='line'>348</span> 
<span class='line'>349</span> </span><span class="COMM">/**
<span class='line'>350</span>  * Constants used by the Criteria and Criterion classes to construct SQL statements.
<span class='line'>351</span>  * @class CritConstants
<span class='line'>352</span>  *
<span class='line'>353</span>  * @property {String} [JOIN="JOIN"] Table join type
<span class='line'>354</span>  * @property {String} [LEFT_JOIN="LEFT JOIN"]  Table join type
<span class='line'>355</span>  * @property {String} [LEFTJOIN="LEFT JOIN"]  Table join type
<span class='line'>356</span>  * @property {String} [IS_NULL=" IS NULL"] null comparison type
<span class='line'>357</span>  * @property {String} [ISNULL=" IS NULL"] null comparison type
<span class='line'>358</span>  * @property {String} [IS_NOT_NULL=" IS NOT NULL"] null comparison type
<span class='line'>359</span>  * @property {String} [ISNOTNULL=" IS NOT NULL"] null comparison type
<span class='line'>360</span>  * @property {String} [EQUAL="="] Comparison type
<span class='line'>361</span>  * @property {String} [NOT_EQUAL="&lt;>"] Comparison type
<span class='line'>362</span>  * @property {String} [NOTEQUAL="&lt;>"] Comparison type
<span class='line'>363</span>  * @property {String} [IN=" IN"] Comparison type
<span class='line'>364</span>  * @property {String} [NOT_IN=" NOT IN"] Comparison type
<span class='line'>365</span>  * @property {String} [NOTIN=" NOT IN"] Comparision type
<span class='line'>366</span>  * @property {String} [NOT_LIKE=" NOT LIKE"] Comparison type
<span class='line'>367</span>  * @property {String} [NOTLIKE=" NOT LIKE"] Comparison type
<span class='line'>368</span>  * @property {String} [LIKE=" LIKE"] Comparison type
<span class='line'>369</span>  * @property {String} [OR=" OR "] conjunction
<span class='line'>370</span>  * @property {String} [AND=" AND "] conjunction
<span class='line'>371</span>  * @property {String} [ON=" ON "] Qualifier for LEFT JOIN
<span class='line'>372</span>  * @property {String} [LIMIT=" LIMIT "] Limit number of results specifier
<span class='line'>373</span>  * @property {String} [DESC=" DESC"] Order by qualifier - descending
<span class='line'>374</span>  * @property {String} [ASC=" ASC"]  "Order by qualifier" - ascending
<span class='line'>375</span>  * @property {String} [GREATER_THAN=">"]  Comparison type
<span class='line'>376</span>  * @property {String} [GREATER_EQUAL=">="]  Comparison type
<span class='line'>377</span>  * @property {String} [LESS_THAN="&lt;"]  Comparison type
<span class='line'>378</span>  * @property {String} [LESS_EQUAL="&lt;="]  Comparison type 
<span class='line'>379</span>  * @property {String} [GREATERTHAN=">"]  Comparison type
<span class='line'>380</span>  * @property {String} [GREATEREQUAL=">="]  Comparison type
<span class='line'>381</span>  * @property {String} [LESSTHAN="&lt;"]  Comparison type
<span class='line'>382</span>  * @property {String} [LESSEQUAL="&lt;="]  Comparison type 
<span class='line'>383</span>  *
<span class='line'>384</span>  * @see Criterion
<span class='line'>385</span>  * @see Criteria
<span class='line'>386</span>  */</span><span class="WHIT"> 
<span class='line'>387</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CritConstants</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">   </span><span class="NAME">JOIN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" JOIN "</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">   </span><span class="NAME">LEFT_JOIN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" LEFT JOIN "</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">   </span><span class="NAME">LEFTJOIN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" LEFT JOIN "</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">   </span><span class="NAME">IS_NULL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" IS NULL"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>392</span> </span><span class="WHIT">   </span><span class="NAME">ISNULL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" IS NULL"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">   </span><span class="NAME">IS_NOT_NULL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" IS NOT NULL"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">   </span><span class="NAME">ISNOTNULL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" IS NOT NULL"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">   </span><span class="NAME">EQUAL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">   </span><span class="NAME">NOT_EQUAL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'&lt;>'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">   </span><span class="NAME">NOTEQUAL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'&lt;>'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">   </span><span class="NAME">IN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" IN"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">   </span><span class="NAME">NOT_IN</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="STRN">" NOT IN"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">   </span><span class="NAME">NOTIN</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="STRN">" NOT IN"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">   </span><span class="NAME">NOT_LIKE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" NOT LIKE"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">   </span><span class="NAME">NOTLIKE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" NOT LIKE"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">   </span><span class="NAME">LIKE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" LIKE"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">   </span><span class="NAME">OR</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" OR "</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">   </span><span class="NAME">AND</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" AND "</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">   </span><span class="NAME">ON</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" ON "</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">   </span><span class="NAME">LIMIT</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" LIMIT "</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">   </span><span class="NAME">ASC</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" ASC"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">   </span><span class="NAME">DESC</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">" DESC"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">   </span><span class="NAME">GREATER_THAN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">">"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>411</span> </span><span class="WHIT">   </span><span class="NAME">GREATERTHAN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">">"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>412</span> </span><span class="WHIT">   </span><span class="NAME">GREATER_EQUAL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">">="</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">   </span><span class="NAME">GREATEREQUAL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">">="</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">   </span><span class="NAME">LESS_THAN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"&lt;"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>415</span> </span><span class="WHIT">   </span><span class="NAME">LESSTHAN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"&lt;"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>416</span> </span><span class="WHIT">   </span><span class="NAME">LESS_EQUAL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"&lt;="</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>417</span> </span><span class="WHIT">   </span><span class="NAME">LESSEQUAL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"&lt;="</span><span class="WHIT">
<span class='line'>418</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>419</span> 
<span class='line'>420</span> 
<span class='line'>421</span> 
<span class='line'>422</span> 
<span class='line'>423</span> </span><span class="COMM">/**
<span class='line'>424</span>  * An inner class that describes the different portions of the WHERE clause of an SQL query.
<span class='line'>425</span>  * The Criterion class should not be directly instantiated. Rather it should be instantiated through Criteria.getNewCriterion
<span class='line'>426</span>  *
<span class='line'>427</span>  * @class Criterion
<span class='line'>428</span>  *
<span class='line'>429</span>  * @property {String|Number[]} values
<span class='line'>430</span>  * @property {String} clauses
<span class='line'>431</span>  * @property {Criteria} p The parent Criteria to which this Criterion is attached
<span class='line'>432</span>  * @property {Number} length The number of clauses that make up this Criterion
<span class='line'>433</span>  * @property {String[]} columns The columns that a will be retrieved, or modified as part of any SQL statement that is constructed with this Criterion
<span class='line'>434</span>  * @property {String[]} peer_tables The tables that any SQL statement constructed with this Criterion will query
<span class='line'>435</span>  *
<span class='line'>436</span>  * @see Criteria#getNewCriterion
<span class='line'>437</span>  * @example
<span class='line'>438</span>  * var c     = new Criteria();
<span class='line'>439</span>  * var crit  = new Criterion(c,"CardPeer::name","Queen of Hearts",CritConstants.NOT_EQUAL);
<span class='line'>440</span>  */</span><span class="WHIT">
<span class='line'>441</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Criterion</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">  </span><span class="NAME">values</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">  </span><span class="NAME">clauses</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">  </span><span class="NAME">columns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">  </span><span class="NAME">p</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>446</span> </span><span class="WHIT">  </span><span class="NAME">length</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>447</span> </span><span class="WHIT">  </span><span class="NAME">peer_tables</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">  
<span class='line'>449</span>  </span><span class="COMM">/** 
<span class='line'>450</span>   * @param {Criteria} parent The Criteria object to which this Criterion object is attached
<span class='line'>451</span>   * @param {String} peer_column The Peer::column to which this Criterion object applies
<span class='line'>452</span>   * @param {mixed} value The value of the peer_column
<span class='line'>453</span>   * @param {String} [comparison=CritConfig.EQUAL] The relationship between the peer_column and the value
<span class='line'>454</span>   */</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT"> </span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="NAME">peer_column</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">comparison</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">   </span><span class="NAME">this.p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">   </span><span class="NAME">this.values.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>458</span> </span><span class="WHIT">   </span><span class="NAME">comparison</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">comparison</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">CritConstants.EQUAL</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>459</span> </span><span class="WHIT">   
<span class='line'>460</span>    </span><span class="NAME">peer_column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>461</span> </span><span class="WHIT">   </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">comparison</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">CritConstants.IN</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'array'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>462</span> </span><span class="WHIT">     </span><span class="NAME">this.clauses</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.table_column</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">comparison</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"("</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>463</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">value.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">          </span><span class="NAME">this.clauses</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"?,"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>465</span> </span><span class="WHIT">     </span><span class="NAME">this.clauses</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"?)"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>466</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">     </span><span class="NAME">this.clauses</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.table_column</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">comparison</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"?"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>468</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>469</span> </span><span class="WHIT">   
<span class='line'>470</span>    
<span class='line'>471</span>    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.peer_tables.contains</span><span class="PUNC">(</span><span class="NAME">peer_column.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>472</span> </span><span class="WHIT">       </span><span class="NAME">this.peer_tables.push</span><span class="PUNC">(</span><span class="NAME">peer_column.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>473</span> 
<span class='line'>474</span> </span><span class="WHIT">   </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.columns.contains</span><span class="PUNC">(</span><span class="NAME">peer_column.column</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">       </span><span class="NAME">this.columns.push</span><span class="PUNC">(</span><span class="NAME">peer_column.column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>476</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>477</span> </span><span class="WHIT"> </span><span class="COMM">/** 
<span class='line'>478</span>   * Add another criterion to this criterion object and join it with an AND conjunction
<span class='line'>479</span>   * @param {Criterion} criterion A criterion object to AND with this object
<span class='line'>480</span>   *
<span class='line'>481</span>   */</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT"> </span><span class="NAME">addAnd</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">criterion</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>483</span> </span><span class="WHIT">   </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">criterion</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Criterion</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">    </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Criterion.addAnd(criterion) expects a Criterion object"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">   </span><span class="NAME">this.values.push</span><span class="PUNC">(</span><span class="NAME">criterion.values</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">   </span><span class="NAME">this.clauses</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CritConstants.AND</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">criterion.getClause</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">   </span><span class="NAME">this.length</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>488</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT"> </span><span class="COMM">/** 
<span class='line'>490</span>   * Add another criterion to this criterion object and join it with an OR conjunction
<span class='line'>491</span>   * @param {Criterion} criterion A criterion object to OR with this object
<span class='line'>492</span>   */</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT"> </span><span class="NAME">addOr</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">criterion</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">   </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">criterion</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Criterion</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">    </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Criterion.addOr(criterion) expects a Criterion object"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">   </span><span class="NAME">this.values.push</span><span class="PUNC">(</span><span class="NAME">criterion.values</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">   </span><span class="NAME">this.clauses</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CritConstants.OR</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">criterion.getClause</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">   </span><span class="NAME">this.length</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>501</span>   * Retrieve the current list of clauses for this criterion
<span class='line'>502</span>   * @returns {String} The Criterion represented as the appropriate portions of an SQL WHERE clause
<span class='line'>503</span>   */</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT"> </span><span class="NAME">getClause</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">   </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"("</span><span class="PUNC">+</span><span class="NAME">this.clauses</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">   </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.clauses</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>510</span>   * Retrieve a list of the values that have been applied to this Criterion object
<span class='line'>511</span>   * @returns {String|Number[]}
<span class='line'>512</span>   */</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT"> </span><span class="NAME">getValues</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.values</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT"> </span><span class="COMM">/** 
<span class='line'>515</span>   * Retrieve a list of the tables that are inclued in this Criterion object
<span class='line'>516</span>   * @returns {String[]}
<span class='line'>517</span>   */</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT"> </span><span class="NAME">getTables</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.peer_tables</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>520</span>   * @returns {String[]} The columns that will make up the SELECT portion of the SQL query for this Criterion
<span class='line'>521</span>   */</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT"> </span><span class="NAME">getColumns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.columns</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>524</span>   * Retrieve a string representation of this Criterion object
<span class='line'>525</span>   * @returns {String}
<span class='line'>526</span>   */</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT"> </span><span class="NAME">getDbug</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getClause</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"["</span><span class="PUNC">+</span><span class="NAME">this.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>528</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>529</span> 
<span class='line'>530</span> 
<span class='line'>531</span> </span><span class="COMM">/**
<span class='line'>532</span>  * A utility class for holding criteria information for an SQL query. 
<span class='line'>533</span>  * @class Criteria
<span class='line'>534</span>  */</span><span class="WHIT">
<span class='line'>535</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">   </span><span class="NAME">Implements</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">Options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Events</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">   </span><span class="NAME">options</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">   </span><span class="NAME">clause</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">   </span><span class="NAME">values</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">   </span><span class="NAME">select_columns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">   </span><span class="NAME">insert_columns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">   </span><span class="NAME">peer_tables</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">   </span><span class="NAME">where_clauses</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">' AND '</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">' OR '</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>544</span> </span><span class="WHIT">   </span><span class="NAME">left_joins</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>545</span> </span><span class="WHIT">   </span><span class="NAME">length</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>546</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>547</span>     * @param {Object} options Options to bind to this Criteria object. Currently no configurable Options are supported by this class.
<span class='line'>548</span>     * @param {Object} events Events to bind to to this Criteria object. Currently no Events are fired by this class
<span class='line'>549</span>     */</span><span class="WHIT">
<span class='line'>550</span> </span><span class="WHIT">   </span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>551</span> </span><span class="WHIT">     </span><span class="NAME">this.setOptions</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>552</span> </span><span class="WHIT">     </span><span class="NAME">this.addEvents</span><span class="PUNC">(</span><span class="NAME">events</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>553</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>554</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>555</span>     * Retrieve a new Criterion object that is not automatically added to this Criteria object. The returned Criterion can be used to chain other Criterions and create a more complex WHERE clause.
<span class='line'>556</span>     * @param {String} peer_column The peer and column that the reutrned Criterion should be associated with, e.g., "CardPeer::name"
<span class='line'>557</span>     * @param {String} value The value that the peer_column should be associated with, e.g., "Ace of Clubs"
<span class='line'>558</span>     * @param {String} comparison The relationship between the value and the peer_column, e.g., "CritConstants.EQUAL"
<span class='line'>559</span>     */</span><span class="WHIT">
<span class='line'>560</span> </span><span class="WHIT">   </span><span class="NAME">getNewCriterion</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">comparison</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Criterion</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">peer_column</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">comparison</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>561</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>562</span>     * Add a Criterion to this Criteria object. If this Criteria contains other Criterion the Criterion will be added with the passed in conjunction
<span class='line'>563</span>     * @param {Criterion} crit
<span class='line'>564</span>     * @param {String} [conjunction=CritConstants.AND]
<span class='line'>565</span>     *
<span class='line'>566</span>     * @see Criterion
<span class='line'>567</span>     */</span><span class="WHIT">
<span class='line'>568</span> </span><span class="WHIT">   </span><span class="NAME">addCriterion</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conjunction</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">crit</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Criterion</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Criteria.addCriterion() expects a Criterion object"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">     </span><span class="NAME">conjunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conjunction</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">CritConstants.AND</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>572</span> </span><span class="WHIT">      
<span class='line'>573</span>      </span><span class="NAME">crit.getTables</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">       </span><span class="NAME">this.peer_tables.include</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>575</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>576</span> 
<span class='line'>577</span> </span><span class="WHIT">     </span><span class="NAME">critValues</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">crit.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">     </span><span class="NAME">crit.getColumns</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">column</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>579</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">column.contains</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>580</span> </span><span class="WHIT">         </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">column.split</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>581</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.insert_columns.contains</span><span class="PUNC">(</span><span class="NAME">column</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>582</span> </span><span class="WHIT">           </span><span class="NAME">this.insert_columns.push</span><span class="PUNC">(</span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">       </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">          </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"Criteria: Attempt to add a duplicate column ("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"='"</span><span class="PUNC">+</span><span class="NAME">critValues</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"'); ignoring"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">          </span><span class="NAME">critValues.splice</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>588</span> 
<span class='line'>589</span> </span><span class="WHIT">     </span><span class="NAME">this.values.push</span><span class="PUNC">(</span><span class="NAME">critValues</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">     </span><span class="NAME">this.where_clauses</span><span class="PUNC">[</span><span class="NAME">conjunction</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">crit.getClause</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">     </span><span class="NAME">this.length</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>592</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>593</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>594</span>     * Add a Criterion to this Criteria object.
<span class='line'>595</span>     * &lt;p>&lt;strong>Potential Issue:&lt;/strong> does add allow the same column to be added more than once?&lt;/p>
<span class='line'>596</span>     * @param {Criterion|String} peer_columnOrCrit
<span class='line'>597</span>     * @param {String} value
<span class='line'>598</span>     * @param {String} [comparison=CritConstants.EQUAL]
<span class='line'>599</span>     *
<span class='line'>600</span>     * @see Criterion
<span class='line'>601</span>     */</span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">   </span><span class="NAME">add</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_columnOrCrit</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">comparison</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">peer_columnOrCrit</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Criterion</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.addCriterion</span><span class="PUNC">(</span><span class="NAME">peer_columnOrCrit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.addCriterion</span><span class="PUNC">(</span><span class="NAME">this.getNewCriterion</span><span class="PUNC">(</span><span class="NAME">peer_columnOrCrit</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">comparison</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">       
<span class='line'>607</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>609</span>     * Add a Criterion to this Criteria object.
<span class='line'>610</span>     * If this Criteria contains other Criterion the Criterion will be added with an 'OR' conjunction
<span class='line'>611</span>     * @param {Criterion|String} peer_columnOrCrit
<span class='line'>612</span>     * @param {String} value
<span class='line'>613</span>     * @param {String} [comparison=CritConstants.EQUAL]
<span class='line'>614</span>     */</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">   </span><span class="NAME">addOr</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">comparison</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Criterion</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.addCriterion</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.addCriterion</span><span class="PUNC">(</span><span class="NAME">this.getNewCriterion</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">comparison</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CritConstants.OR</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>619</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>621</span>     * Add a Criterion to this Criteria object.
<span class='line'>622</span>     * If this Criteria contains other Criterion the Criterion will be added with an 'AND' conjunction
<span class='line'>623</span>     * @param {Criterion|String} peer_columnOrCrit
<span class='line'>624</span>     * @param {String} value
<span class='line'>625</span>     * @param {String} [comparison=CritConstants.EQUAL]
<span class='line'>626</span>     *
<span class='line'>627</span>     * @see Criteria#add
<span class='line'>628</span>     */</span><span class="WHIT">   
<span class='line'>629</span>     </span><span class="NAME">addAnd</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">comparison</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Criterion</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.addCriterion</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>632</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.addCriterion</span><span class="PUNC">(</span><span class="NAME">this.getNewCriterion</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">comparison</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>633</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>635</span>     * Add a column to the SELECT clause of the SQL statement that will be executed against the database.
<span class='line'>636</span>     * &lt;p>The ImpelPeer.doSelect, etc., methods automatically add the necessary columns to the SELECT clause,
<span class='line'>637</span>     * so this method does not need to be called manually. If you do call it then only columns that have
<span class='line'>638</span>     * associated attributes in the ImpelClass object will be hydrated. To get at the column you will need
<span class='line'>639</span>     * to pass the Criteria to the ImpelPeer.executeSQL method then access the SQLResultSet that it passes
<span class='line'>640</span>     * off to your success callback.&lt;/p>
<span class='line'>641</span>     *
<span class='line'>642</span>     * @param {String} peer_column The Peer::column to add.
<span class='line'>643</span>     * @see Criteria#getSelectColumns
<span class='line'>644</span>     * @example
<span class='line'>645</span>     * var c = new Criteria();
<span class='line'>646</span>     *     c.add("PlayerPeer::debt",50000,CritConstants.GREATER_EQUAL);
<span class='line'>647</span>     *     c.addSelectColumn.("PlayerPeer::name");
<span class='line'>648</span>     *     c.addSelectColumn.("PlayerPeer::address");
<span class='line'>649</span>     *     PlayerPeer.executeSQL(c.getSelectSQL,c.getValues(),function(rs){
<span class='line'>650</span>     *                         new ResultSet(rs).toArray().each(function(row){
<span class='line'>651</span>     *                           notify.show("Lenny go collect from "+ row[0] +". He lives at "+ row[1]);
<span class='line'>652</span>     *                         });
<span class='line'>653</span>     *                       })
<span class='line'>654</span>     */</span><span class="WHIT">   
<span class='line'>655</span>    </span><span class="NAME">addSelectColumn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">     </span><span class="NAME">peer_column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">     </span><span class="NAME">this.select_columns.push</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">[</span><span class="STRN">'table_column'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" AS "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"'"</span><span class="PUNC">+</span><span class="NAME">peer_column</span><span class="PUNC">[</span><span class="STRN">'table_column'</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"'"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>658</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>659</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>660</span>     * Retrieve a list of columns that will be used to make up the SELECT 
<span class='line'>661</span>     * @return {Array} The columns
<span class='line'>662</span>     * @see Criteria#addSelectColumn
<span class='line'>663</span>     */</span><span class="WHIT">   
<span class='line'>664</span>    </span><span class="NAME">getSelectColumns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.select_columns</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>668</span>     * Does this Criteria contain any columns that will be used in the SELECT clause of an SQL statment?
<span class='line'>669</span>     * @return {boolean}
<span class='line'>670</span>     * @see Criteria#addSelectColumn
<span class='line'>671</span>     * @see Criteria#getSelectColumns
<span class='line'>672</span>     */</span><span class="WHIT">
<span class='line'>673</span> </span><span class="WHIT">   </span><span class="NAME">hasSelectColumns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.select_columns.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>678</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>679</span>     * Does this Criteria contain a LEFT JOIN clause for the given peer_column.
<span class='line'>680</span>     * @params {String|Object} peer_column The Peer::column to check
<span class='line'>681</span>     * @return {Boolean}
<span class='line'>682</span>     */</span><span class="WHIT">
<span class='line'>683</span> </span><span class="WHIT">   </span><span class="NAME">leftJoinsHas</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>684</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">         </span><span class="NAME">peer_column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">       </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">peer_column</span><span class="PUNC">[</span><span class="STRN">'peer'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">          </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Criteria.leftJoinsHas() expects a Peer::column String, or parsed Peer::column argument"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">        
<span class='line'>689</span>        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.left_joins.getKeys</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">contains</span><span class="PUNC">(</span><span class="NAME">peer_column.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">        
<span class='line'>692</span>        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">truth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">table</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">          </span><span class="NAME">truth</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">          </span><span class="NAME">table</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">          </span><span class="NAME">keys</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.left_joins.getKeys</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">       </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">keys.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.left_joins</span><span class="PUNC">[</span><span class="NAME">keys</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">'left'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">table</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">            </span><span class="NAME">truth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">truth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>705</span>     * Add a JOIN clause to this Criteria.
<span class='line'>706</span>     * &lt;p>Currently only JOIN and LEFT JOIN are supported join opperators.&lt;/p>
<span class='line'>707</span>     *
<span class='line'>708</span>     * @param {String} left The peer_column (table) that is the left side of the JOIN, e.g., "PlayerPeer::card_table_id"
<span class='line'>709</span>     * @param {String} right The peer_column (table) that is the right side of the JOIN, e.g., "CardTablePeer::id"
<span class='line'>710</span>     * @param {String} [operator=CritConstants.JOIN] The type of JOIN, e.g., CritConstants.LEFT_JOIN
<span class='line'>711</span>     * 
<span class='line'>712</span>     */</span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">   </span><span class="NAME">addJoin</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">,</span><span class="NAME">operator</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>714</span> </span><span class="WHIT">     </span><span class="NAME">left</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">left.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>715</span> </span><span class="WHIT">     </span><span class="NAME">right</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">right.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>716</span> </span><span class="WHIT">     </span><span class="COMM">// currently we only support LEFT_JOIN and JOIN, but we also want to make sure that the operator is not null</span><span class="WHIT">
<span class='line'>717</span> </span><span class="WHIT">     </span><span class="NAME">operator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">operator</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">CritConstants.LEFT_JOIN</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">operator</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">CritConstants.JOIN</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">     
<span class='line'>719</span>      
<span class='line'>720</span>      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">operator</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">CritConstants.JOIN</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.leftJoinsHas</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">           </span><span class="NAME">this.peer_tables.include</span><span class="PUNC">(</span><span class="NAME">left.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.leftJoinsHas</span><span class="PUNC">(</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>724</span> </span><span class="WHIT">           </span><span class="NAME">this.peer_tables.include</span><span class="PUNC">(</span><span class="NAME">right.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>725</span> </span><span class="WHIT">       </span><span class="NAME">this.where_clauses</span><span class="PUNC">[</span><span class="NAME">CritConstants.AND</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">left.table_column</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">CritConstants.EQUAL</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">right.table_column</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>726</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">operator</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">CritConstants.LEFT_JOIN</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>727</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">this.left_joins</span><span class="PUNC">[</span><span class="NAME">right.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">          </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Cannot use the same table as the right side of two LEFT JOIN statements: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">right.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>729</span> </span><span class="WHIT">       </span><span class="NAME">this.left_joins</span><span class="PUNC">[</span><span class="NAME">right.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">left.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'ON'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">CritConstants.ON</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">left.table_column</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">CritConstants.EQUAL</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">right.table_column</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>730</span> </span><span class="WHIT">       </span><span class="COMM">// this is relating tables that it should not</span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">       </span><span class="NAME">this.peer_tables.erase</span><span class="PUNC">(</span><span class="NAME">right.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">       </span><span class="NAME">this.peer_tables.erase</span><span class="PUNC">(</span><span class="NAME">left.peer.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">   </span><span class="NAME">leftJoinDbug</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">     </span><span class="NAME">this.left_joins.getKeys</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">       </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">+</span><span class="STRN">": "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>738</span> </span><span class="WHIT">       </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">this.left_joins.get</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>739</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>740</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>742</span>     * Retrieve an Object representing the LEFT JOIN clauses that have been added to this Criteria.
<span class='line'>743</span>     * &lt;pre>
<span class='line'>744</span>     * The left_joins DataStructure looks like this:
<span class='line'>745</span>     * { right_table_name : { 'ON' : " ON left_column = right_column", 'left' : left_table_name } }
<span class='line'>746</span>     * &lt;/pre>
<span class='line'>747</span>     *
<span class='line'>748</span>     * &lt;p>We go through the each top level item of the Object; pull out the left table_table_name then look for any other entires that use it as their right_table_name.
<span class='line'>749</span>     * If we find any we add ourselves to the end of their ON clause and erase our entry. Then we go through the Object one more time constructing queries to look like
<span class='line'>750</span>     * left_table_name LEFT JOIN right_table_name ON left_colum = right_column LEFT JOIN another_right_table_name ON ..., left_table_name LEFT JOIN right_table_name ON left_colum = right_column.&lt;/p>
<span class='line'>751</span>     *
<span class='line'>752</span>     * &lt;p>The current implementation probably has a bug in that more than two nested LEFT JOINs using the same table won't come out correct. This will be fixed before we go to beta.&lt;/p>
<span class='line'>753</span>     *
<span class='line'>754</span>     * @returns {Object} 
<span class='line'>755</span>     * @see Criteria#addJoin
<span class='line'>756</span>     */</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">   </span><span class="NAME">getLeftJoinClauses</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">     </span><span class="NAME">this.left_joins.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">join</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>759</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.has</span><span class="PUNC">(</span><span class="NAME">join</span><span class="PUNC">[</span><span class="STRN">'left'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">         </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">join</span><span class="PUNC">[</span><span class="STRN">'left'</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">CritConstants.ON</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CritConstants.LEFT_JOIN</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">right</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">join</span><span class="PUNC">[</span><span class="STRN">'ON'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">         </span><span class="NAME">this.erase</span><span class="PUNC">(</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="NAME">this.left_joins</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">     
<span class='line'>765</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ljs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">     </span><span class="NAME">this.left_joins.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">join</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">       </span><span class="NAME">ljs.push</span><span class="PUNC">(</span><span class="NAME">join</span><span class="PUNC">[</span><span class="STRN">'left'</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">CritConstants.LEFT_JOIN</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">right</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">join</span><span class="PUNC">[</span><span class="STRN">'ON'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">     
<span class='line'>770</span>      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ljs.join</span><span class="PUNC">(</span><span class="STRN">", "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">     
<span class='line'>772</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>774</span>     * Retrieve a complete SQL SELECT statment constructed from this Criteria.
<span class='line'>775</span>     * &lt;p>The select columns, table names, joins, and where clauses will be automatically added to the statement before it is returned&lt;/p>
<span class='line'>776</span>     *
<span class='line'>777</span>     * @return {String} an SQL SELECT statement
<span class='line'>778</span>     * @see ImpelPeer#doSelect
<span class='line'>779</span>     */</span><span class="WHIT">
<span class='line'>780</span> </span><span class="WHIT">   </span><span class="NAME">getSelectSQL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">     
<span class='line'>781</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"SELECT "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.getSelectModifiers</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.select_columns.join</span><span class="PUNC">(</span><span class="STRN">', '</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" FROM "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.left_joins.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">        </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getLeftJoinClauses</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">        </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.getTableNames</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">", "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.getTableNames</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">        </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getTableNames</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">      
<span class='line'>790</span>         </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getWhereClause</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">      
<span class='line'>792</span>       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.options.groupby</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">        </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.options.groupby</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.options.orderby</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">        </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.options.orderby</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.limit</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">        </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CritConstants.LIMIT</span><span class="PUNC">+</span><span class="NAME">this.options.limit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">      
<span class='line'>799</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">";"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>800</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>801</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>802</span>     * Retrieve only the WHERE clauses portion of an SQL statement constructed from this Criteria.
<span class='line'>803</span>     *
<span class='line'>804</span>     * @returns {String} The WHERE clause for this Criteria.
<span class='line'>805</span>     * @see Criteria#getSelectSQL
<span class='line'>806</span>     * @see Criteria#getUpdateSQL
<span class='line'>807</span>     */</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">   </span><span class="NAME">getWhereClause</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.where_clauses</span><span class="PUNC">[</span><span class="NAME">CritConstants.AND</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.where_clauses</span><span class="PUNC">[</span><span class="NAME">CritConstants.OR</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">       </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"WHERE "</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.where_clauses</span><span class="PUNC">[</span><span class="NAME">CritConstants.AND</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">       </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.where_clauses</span><span class="PUNC">[</span><span class="NAME">CritConstants.AND</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="NAME">CritConstants.AND</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.where_clauses</span><span class="PUNC">[</span><span class="NAME">CritConstants.OR</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.where_clauses</span><span class="PUNC">[</span><span class="NAME">CritConstants.AND</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">         </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CritConstants.AND</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">       </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.where_clauses</span><span class="PUNC">[</span><span class="NAME">CritConstants.OR</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="NAME">CritConstants.OR</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>822</span>     * Retrieve a complete SQL Insert statement constructed from this Criteria.
<span class='line'>823</span>     * &lt;p>The columns, values, and table names, will be automatically added to the statement before it is returned&lt;/p>
<span class='line'>824</span>     *
<span class='line'>825</span>     * @example
<span class='line'>826</span>     *   var c = new Criteria();
<span class='line'>827</span>     *       c.add("PlayerPeer::name","Johnny Big");
<span class='line'>828</span>     *       c.add("PlayerPeer::debt",0);
<span class='line'>829</span>     *       c.add("PlayerPeer::card_table_id",7);
<span class='line'>830</span>     *
<span class='line'>831</span>     *   PlayerPeer.executeSQL(c.getInsertSQL(),c.getValues(),$empty,
<span class='line'>832</span>     *                         function(e){
<span class='line'>833</span>     *                           notify.error("Failed to add Jonny to DB:",e);
<span class='line'>834</span>     *                         });
<span class='line'>835</span>     *
<span class='line'>836</span>     * @returns {String} An SQL INSERT statement
<span class='line'>837</span>     * @see ImpelClass#save
<span class='line'>838</span>     */</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">   </span><span class="NAME">getInsertSQL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"INSERT INTO "</span><span class="PUNC">+</span><span class="NAME">this.getTableNames</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"("</span><span class="PUNC">+</span><span class="NAME">this.insert_columns.join</span><span class="PUNC">(</span><span class="STRN">', '</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">") VALUES("</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">     </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.insert_columns.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">       </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"?,"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">     </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"?);"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">     
<span class='line'>845</span>      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>848</span>     * Retrieve a complet SQL Update statement constructed from this Criteria.
<span class='line'>849</span>     * @params {Criteria} constrainCrit The criteria to use to constrain the UPDATE statement
<span class='line'>850</span>     * @returns {String} An SQL UPDATE statement
<span class='line'>851</span>     * @see ImpelClass#save
<span class='line'>852</span>     */</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">   </span><span class="NAME">getUpdateSQL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">constrainCrit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">this.insert_columns</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'array'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.insert_columns.length</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>855</span>       </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"You must call Criteria::add() for each column that is to be updated before Criteria::getUpdateSQL(constrainCrit)"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">constrainCrit</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Criteria::getUpdateSQL(constrainCrit) expects another Criteria object as an argument"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>858</span> 
<span class='line'>859</span> </span><span class="WHIT">      </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"UPDATE "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.getTableNames</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" SET "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.insert_columns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"=?"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.insert_columns.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">          </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">this.insert_columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"=?"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">      
<span class='line'>864</span>       </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">+</span><span class="NAME">constrainCrit.getWhereClause</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">      
<span class='line'>866</span>       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.limit</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">        </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CritConstants.LIMIT</span><span class="PUNC">+</span><span class="NAME">this.options.limit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">      </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">constrainCrit.options.limit</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">        </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CritConstants.LIMIT</span><span class="PUNC">+</span><span class="NAME">constrainCrit.options.limit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">      
<span class='line'>871</span>       </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">";"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">      
<span class='line'>873</span>       </span><span class="COMM">// The WHERE clause from the constrainCrit limits the UPDATE but it contains '?'s instead of values, so we need to combine ours with theirs.</span><span class="WHIT">
<span class='line'>874</span> </span><span class="WHIT">      </span><span class="COMM">// Note that getValues should be used to retrieve the values from this object when actually using them because it flattens the array before</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">      </span><span class="COMM">// returning</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">      </span><span class="NAME">this.values.push</span><span class="PUNC">(</span><span class="NAME">constrainCrit.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>877</span> </span><span class="WHIT">      
<span class='line'>878</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>881</span>     * Retrieve a complete SQL DELETE statement constructed from this Criteria.
<span class='line'>882</span>     * @return {String} An SQL DELETE statement
<span class='line'>883</span>     * @see ImpelClass#remove
<span class='line'>884</span>     */</span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">   </span><span class="NAME">getDeleteSQL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"DELETE FROM "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.getTableNames</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.getWhereClause</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">";"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>889</span>     * Retrieve all values that have been added to this Criteria in the order they were added.
<span class='line'>890</span>     * &lt;p>The getInsertSQL, etc., methods construct the SQL statemetn with '?' in place of values. ImpelPeer.executeSQL 
<span class='line'>891</span>     * expects this and so requires an array of variables as the second argument. It will then prepare the values before
<span class='line'>892</span>     * executing the full SQL statement.&lt;/p>
<span class='line'>893</span>     *
<span class='line'>894</span>     * @returns {Array} The values associated with this Criteria in the order they were added.
<span class='line'>895</span>     * @see ImpelPeer#executeSQL
<span class='line'>896</span>     */</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">   </span><span class="NAME">getValues</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.values.flatten</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>901</span>     * Add a table to the list of tables that will be used in any SQL statement constructed from this Criteria.
<span class='line'>902</span>     * The ImpelPeer.doSelectOne, etc., methods automatically add the necessary tables, so this method really shouldn't be
<span class='line'>903</span>     * called outside of the ImpelPeer methods.
<span class='line'>904</span>     *
<span class='line'>905</span>     * @param {String} table The name of the table to add
<span class='line'>906</span>     */</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">   </span><span class="NAME">addTable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">     </span><span class="NAME">this.peer_tables.include</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>909</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>911</span>     * Retrive a list of all the tables that will be used in any SQL statement constructed from this Criteria.
<span class='line'>912</span>     *
<span class='line'>913</span>     * @returns {String} A list of the tables separated by commas
<span class='line'>914</span>     * @see Criteria#addTable
<span class='line'>915</span>     *
<span class='line'>916</span>     * @example
<span class='line'>917</span>     * var c = new Criteria();
<span class='line'>918</span>     *     c.add("PlayerPeer::name","Johnny Small");
<span class='line'>919</span>     *     c.add("CardTablePeer::number",7);
<span class='line'>920</span>     *
<span class='line'>921</span>     * var tables = c.getTableNames();
<span class='line'>922</span>     *
<span class='line'>923</span>     * tables now equals "player,cardtable"
<span class='line'>924</span>     */</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">   </span><span class="NAME">getTableNames</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>926</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.peer_tables.join</span><span class="PUNC">(</span><span class="STRN">', '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>929</span>     * Retrieve any modifiers that have been added to the SELECT clause of the Criteria.
<span class='line'>930</span>     *
<span class='line'>931</span>     * @returns {String} "DISTINCT" || '';
<span class='line'>932</span>     * @see Criteria#setDistinct
<span class='line'>933</span>     */</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">   </span><span class="NAME">getSelectModifiers</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.options.distinct</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">" DISTINCT "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>941</span>     * Set a limit on the number of results.
<span class='line'>942</span>     * @param {Number} limit
<span class='line'>943</span>     */</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">   </span><span class="NAME">setLimit</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">limit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">     </span><span class="NAME">this.options.limit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">limit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>948</span>     * Add the DISTINCT modifier to the SELECT clause of any SQL statement constructed from this Criteria.
<span class='line'>949</span>     */</span><span class="WHIT">
<span class='line'>950</span> </span><span class="WHIT">   </span><span class="NAME">setDistinct</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">     </span><span class="NAME">this.options.distinct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>954</span>     * Sort the results of any SQL query constructed from this Criteria by the column specified in ascending order
<span class='line'>955</span>     * @param {String} peer_column
<span class='line'>956</span>     * @see Criteria#addDescendingOrderByColumn
<span class='line'>957</span>     *
<span class='line'>958</span>     * @example
<span class='line'>959</span>     * var c = new Criteria();
<span class='line'>960</span>     *     c.addAscendingOrderByColumn("PlayePeer::zipcode");
<span class='line'>961</span>     */</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">   </span><span class="NAME">addAscendingOrderByColumn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">     </span><span class="NAME">this.options.orderby</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"ORDER BY "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">peer_column.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="STRN">'table_column'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">CritConstants.ASC</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>965</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>966</span>     * Sort the results of any SQL query constructed from this Criteria by the column specified in descending order
<span class='line'>967</span>     * @param {String} peer_column
<span class='line'>968</span>     * @see Criteria#addAscendingOrderByColumn
<span class='line'>969</span>     *
<span class='line'>970</span>     * @example
<span class='line'>971</span>     * var c = new Criteria();
<span class='line'>972</span>     *     c.addDescendingOrderByColumn("PlayerPeer::zipcode");
<span class='line'>973</span>     */</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">   </span><span class="NAME">addDescendingOrderByColumn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">     </span><span class="NAME">this.options.orderby</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"ORDER BY "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">peer_column.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="STRN">'table_column'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">CritConstants.DESC</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>978</span>     * Group the results of any SQL query constructed from this Criteria by the column specified
<span class='line'>979</span>     *
<span class='line'>980</span>     * @param {String} peer_column
<span class='line'>981</span>     */</span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">   </span><span class="NAME">addGroupByColumn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">     </span><span class="NAME">this.options.groupby</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"GROUP BY "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">peer_column.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="STRN">'table_column'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>986</span>     * @private
<span class='line'>987</span>     */</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">   </span><span class="NAME">addAsColumn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">clause</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">     
<span class='line'>990</span>    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>992</span> 
<span class='line'>993</span> 
<span class='line'>994</span> 
<span class='line'>995</span> </span><span class="COMM">/**
<span class='line'>996</span>  * A utility class for managing interactions between objects and their associated records in the database.
<span class='line'>997</span>  * &lt;p>Any class of objects that you want to persist in the database must have an associated ImpelPeer object.&lt;/p>
<span class='line'>998</span>  * &lt;p>An ImpelPeer object defines the names of the attributes for the ImpelClass object, its associated table
<span class='line'>999</span>  *    and columns in the database. It must also define the name of the ImpelClass object.&lt;/p>
<span class='line'>1000</span>  *
<span class='line'>1001</span>  * @class ImpelPeer 
<span class='line'>1002</span>  *
<span class='line'>1003</span>  */</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ImpelPeer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">   </span><span class="NAME">Implements</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">Options</span><span class="PUNC">,</span><span class="NAME">Events</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">   </span><span class="NAME">options</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">     </span><span class="STRN">'columns'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">     </span><span class="STRN">'table'</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">     </span><span class="STRN">'base_object'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">   </span><span class="NAME">columns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="WHIT">   </span><span class="NAME">deleting_ids</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="WHIT">   </span><span class="NAME">has_manys</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">   </span><span class="NAME">has_many_throughs</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1016</span>    * @param {Object} options Options to bind to this ImpelPeer object. Currently no configurable Options are supported by this class.
<span class='line'>1017</span>    * @param {Object} events Events to bind to to this ImpelPeer object. Currently no Events are fired by this class
<span class='line'>1018</span>    */</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">   </span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">     </span><span class="NAME">this.setOptions</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">     </span><span class="NAME">this.addEvents</span><span class="PUNC">(</span><span class="NAME">events</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">     </span><span class="NAME">this.options.columns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="NAME">this.options.columns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">     </span><span class="NAME">this.generateAttributes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">     </span><span class="NAME">this.generateMethods</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1026</span> 
<span class='line'>1027</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1028</span>     * Retrieve the name of the class associated with this peer object.
<span class='line'>1029</span>     * @returns {String} The name of the class associated with this peer object, e.g., CardPeer.getBaseObjName() will return "Card"
<span class='line'>1030</span>     */</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">   </span><span class="NAME">getBaseObjName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.options.base_object</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">   </span><span class="COMM">/** 
<span class='line'>1035</span>     * Dynamically build the attributes of the ImpelClass object associated with this ImpelPeer object based on the columns that were specified when instantiating this object.
<span class='line'>1036</span>     * It may at some point be worth while to write this into a code generator, so that it only needs to be called during development. Of course that would increase the size
<span class='line'>1037</span>     * of the code delivered to the user, so it is a network bandwidth v.s. CPU utilization issue.
<span class='line'>1038</span>     *
<span class='line'>1039</span>     * &lt;ul>
<span class='line'>1040</span>     *   &lt;lh>&lt;strong>Important Notes:&lt;/strong>&lt;/lh>
<span class='line'>1041</span>     *   &lt;li>The ImpelClass must be defined within the scope of window&lt;/li>
<span class='line'>1042</span>     *   &lt;li>This method should not be called directly because the constructor will call it. If you add columns to the peer after instantiation THEN call this method manually.&lt;/li>
<span class='line'>1043</span>     * &lt;/ul>
<span class='line'>1044</span>     * 
<span class='line'>1045</span>     * 
<span class='line'>1046</span>     *
<span class='line'>1047</span>     * @returns {undefined} The ImpelClass class definition that is associated with this ImpelPeer instnace will be modified to include new attributes
<span class='line'>1048</span>     */</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">   </span><span class="NAME">generateAttributes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mods</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">           </span><span class="NAME">mods.attributes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">       </span><span class="NAME">this.options.columns.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">,</span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">         </span><span class="NAME">mods.attributes</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">        
<span class='line'>1056</span>        </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.options.base_object</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">implement</span><span class="PUNC">(</span><span class="NAME">mods</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>1059</span>    * Dynamically build the set/get methods of the ImpelClass object associated with this ImpelPeer object based on the columns that were specified when instantiating this object.
<span class='line'>1060</span>    * It may at some point be worth while to write this into a code generator, so that it only needs to be called during development. Of course that would increase the size
<span class='line'>1061</span>    * of the code delivered to the user, so it is a network bandwidth v.s. CPU utilization issue.
<span class='line'>1062</span>    * &lt;ul>
<span class='line'>1063</span>    *   &lt;lh>&lt;strong>Important Notes:&lt;/strong>&lt;/lh>
<span class='line'>1064</span>    *   &lt;li>The ImpelClass must be defined within the scope of window&lt;/li>
<span class='line'>1065</span>    *   &lt;li>This method should not be called directly because the constructor will call it. If you add columns to the peer after instantiation THEN call this method manually.&lt;/li>
<span class='line'>1066</span>    * &lt;/ul>
<span class='line'>1067</span>    *
<span class='line'>1068</span>    * @returns {undefined} The ImpelClass class definition that is associated with this ImpelPeer instance will be modified to include new methods
<span class='line'>1069</span>    * @see ImpelClass#generateDocs
<span class='line'>1070</span>    */</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">   </span><span class="NAME">generateMethods</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mods</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">       </span><span class="NAME">this.options.columns.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">,</span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">           </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getter</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">'get-'</span><span class="PUNC">+</span><span class="NAME">attr.replace</span><span class="PUNC">(</span><span class="REGX">/_/g</span><span class="PUNC">,</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">camelCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">           </span><span class="NAME">mods</span><span class="PUNC">[</span><span class="NAME">getter</span><span class="PUNC">]</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>1076</span>              </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1077</span>           </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">           </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">setter</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">'set-'</span><span class="PUNC">+</span><span class="NAME">attr.replace</span><span class="PUNC">(</span><span class="REGX">/_/g</span><span class="PUNC">,</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">camelCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">           </span><span class="NAME">mods</span><span class="PUNC">[</span><span class="NAME">setter</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>1080</span>              </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">             </span><span class="NAME">this.modified_columns.push</span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">       </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.options.base_object</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">implement</span><span class="PUNC">(</span><span class="NAME">mods</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1085</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">    </span><span class="COMM">/** 
<span class='line'>1087</span>      * Add the select columns, that are necessary to hydrate the associated ImpelClass object from a database row, to a Criteria object 
<span class='line'>1088</span>      * @param {Criteria} [crit] - The Criteria object that will be used to retrieve rows from the database
<span class='line'>1089</span>      *
<span class='line'>1090</span>      * @returns {Criteria} If a Criteria object is not passed in one will be created and returned. If a Criteria object is passed in that 
<span class='line'>1091</span>      * it will be modified and returned, but because JavaScript passes object by reference you do not need to assign the return back to your
<span class='line'>1092</span>      * Criteria object.
<span class='line'>1093</span>      *
<span class='line'>1094</span>      * @see Criteria#addSelectColumn
<span class='line'>1095</span>      */</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">   </span><span class="NAME">addSelectColumns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">     </span><span class="NAME">crit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">crit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">     </span><span class="COMM">// this should really be a for(name in this.options.columns) loop</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="WHIT">     </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="NAME">this.options.columns</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getKeys</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">       </span><span class="NAME">crit.addSelectColumn</span><span class="PUNC">(</span><span class="NAME">this.options.base_object</span><span class="PUNC">+</span><span class="STRN">"Peer::"</span><span class="PUNC">+</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  
<span class='line'>1101</span>      </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">crit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">   </span><span class="COMM">/** 
<span class='line'>1105</span>     * Add the table, in which this ImpelClass's data is stored in the database, to a Criteria object 
<span class='line'>1106</span>     * @param {Criteria} crit - The Criteria object that will be used to retrieve rows from the database
<span class='line'>1107</span>     *
<span class='line'>1108</span>     * @returns {Criteria} If a Criteria object is not passed in one will be created and returned. If a Criteria object is passed in that 
<span class='line'>1109</span>     * it will be modified and returned, but because JavaScript passes object by reference you do not need to assign the return back to your
<span class='line'>1110</span>     * Criteria object.
<span class='line'>1111</span>     *
<span class='line'>1112</span>     * @see Criteria#addTable
<span class='line'>1113</span>     * @see ImpelPeer#getTableName
<span class='line'>1114</span>     */</span><span class="WHIT">
<span class='line'>1115</span> </span><span class="WHIT">   </span><span class="NAME">addTable</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">     </span><span class="NAME">crit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">crit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">crit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">     </span><span class="NAME">crit.addTable</span><span class="PUNC">(</span><span class="NAME">this.getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">crit</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1121</span>     * Retrieve an internal object that defines the names of the attributes and columns for this ImpelPeer's associated ImpelClass.
<span class='line'>1122</span>     *
<span class='line'>1123</span>     * @returns {Object} An object representing the attributes and columns for this ImpelPeer
<span class='line'>1124</span>     * &lt;pre class="code brush: js;">
<span class='line'>1125</span>     *{
<span class='line'>1126</span>     *   'id'          : 'player.id', 
<span class='line'>1127</span>     *   'name'        : 'player.name', 
<span class='line'>1128</span>     *   'created_at'  : 'player.created_at',
<span class='line'>1129</span>     *   'updated_at'  : 'player.updated_at'
<span class='line'>1130</span>     *} 
<span class='line'>1131</span>     * &lt;/pre>
<span class='line'>1132</span>     */</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">   </span><span class="NAME">getColumns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.options.columns</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1137</span>     * Retrieve the name of the table that is associate with this ImpelPeer.
<span class='line'>1138</span>     * @returns {String}
<span class='line'>1139</span>     */</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">   </span><span class="NAME">getTableName</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.options.table</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1144</span>     * Retrieve a comma separated list of the columns that will be used to create an SQL SELECT statement for this ImpelPeer.
<span class='line'>1145</span>     * &lt;p>&lt;em>Important Note:&lt;/em> The columns will be specified using AS clauses because the HTML 5, or SQLite, RDBMS 
<span class='line'>1146</span>     * impelementation will overwrite columns with the same name from separate tables.&lt;/p>
<span class='line'>1147</span>     *
<span class='line'>1148</span>     * @returns {String}
<span class='line'>1149</span>     */</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">   </span><span class="NAME">getSelectColumns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1152</span> </span><span class="WHIT">     </span><span class="NAME">this.options.columns.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">col</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1153</span> </span><span class="WHIT">       </span><span class="NAME">cols.push</span><span class="PUNC">(</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" AS '"</span><span class="PUNC">+</span><span class="NAME">col</span><span class="PUNC">+</span><span class="STRN">"'"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1154</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cols.join</span><span class="PUNC">(</span><span class="STRN">', '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1158</span>     * Execute an arbitrary SQL statement against the database.
<span class='line'>1159</span>     * If the query is succesfull call a particular method of a particular object. Also call specified 
<span class='line'>1160</span>     * success and failure callbacks as necessary.
<span class='line'>1161</span>     *
<span class='line'>1162</span>     * @param {String} stmt                        The SQL statement to execute
<span class='line'>1163</span>     * @param {Array} [values]                     A set of values to to insert into the SQL statement after properly perparing them
<span class='line'>1164</span>     * @param {function} [s_callback(SQLResultSet)]  The function to call if the transaction succeeds
<span class='line'>1165</span>     * @param {function} [f_callback(Error)]         The function to call if the transaction fails
<span class='line'>1166</span>     * @param {Object} obj                         The object that is being affected by this transaction
<span class='line'>1167</span>     * @param {method} obj_method                  The method in the object to call after the transaction succeeds
<span class='line'>1168</span>     * @param {database} [con]                     The database to execute against. If null then Impel.db is used
<span class='line'>1169</span>     * 
<span class='line'>1170</span>     * &lt;p>On success s_callback will be called with an SQLResultSet as an arument. An SQLResultSet contains:&lt;/p>
<span class='line'>1171</span>     *   &lt;ul>
<span class='line'>1172</span>     *     &lt;li>int insertId: -1 if not insert was performed&lt;/li>
<span class='line'>1173</span>     *     &lt;li>int rowsAffected: 0 if no rows were updated or inserted&lt;/li>
<span class='line'>1174</span>     *     &lt;li>SQLResultSetRowList rows: the rows that were returned
<span class='line'>1175</span>     *         &lt;ul>
<span class='line'>1176</span>     *           &lt;li>int length&lt;/li>
<span class='line'>1177</span>     *           &lt;li>function item(index): retrieve the row at a given relative index&lt;/li>
<span class='line'>1178</span>     *         &lt;/ul>
<span class='line'>1179</span>     *     &lt;/li>
<span class='line'>1180</span>     *   &lt;/ul>
<span class='line'>1181</span>     *
<span class='line'>1182</span>     * @returns {undefined} To access the data retrieved pass in a callback function, or an Object and a method to call.
<span class='line'>1183</span>     */</span><span class="WHIT">
<span class='line'>1184</span> </span><span class="WHIT">   </span><span class="NAME">executeSQL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="PUNC">,</span><span class="NAME">values</span><span class="PUNC">,</span><span class="NAME">s_callback</span><span class="PUNC">,</span><span class="NAME">f_callback</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">obj_method</span><span class="PUNC">,</span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="WHIT">     </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Impel.db</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">       </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"No suitable database connection found. Assign one to Impel.db"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">     
<span class='line'>1189</span>      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="WHIT">       </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"executeSQL(sql,values,success_callback,failure_callback) requires an at least an SQL statment"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1191</span> </span><span class="WHIT">     
<span class='line'>1192</span>      </span><span class="NAME">values</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">values</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1193</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">values</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'array'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1194</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"ImpelPeer::executeSQL - second parameter (values) must be an array."</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="WHIT">      
<span class='line'>1196</span>      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">s_callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1197</span> </span><span class="WHIT">        </span><span class="NAME">s_callback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$empty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1198</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">f_callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1199</span> </span><span class="WHIT">        </span><span class="NAME">f_callback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$empty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1200</span> </span><span class="WHIT">      
<span class='line'>1201</span>      </span><span class="NAME">con.transaction</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">transaction</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="WHIT">            </span><span class="NAME">dbug.time</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ["</span><span class="PUNC">+</span><span class="NAME">values</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1203</span> </span><span class="WHIT">            </span><span class="NAME">transaction.executeSql</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="PUNC">,</span><span class="NAME">values</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1204</span>                </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">trans</span><span class="PUNC">,</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>1205</span>                   </span><span class="NAME">dbug.timeEnd</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ["</span><span class="PUNC">+</span><span class="NAME">values</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">                  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj_method</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">                      </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">obj_method</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> 
<span class='line'>1210</span>                       </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="STRN">'callback'</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">                  </span><span class="NAME">s_callback</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1213</span>                </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">               </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">dbug.timeEnd</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ["</span><span class="PUNC">+</span><span class="NAME">values</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">f_callback</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">             </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="WHIT">           </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">dbug.timeEnd</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ["</span><span class="PUNC">+</span><span class="NAME">values</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">f_callback</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">     </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1220</span>     * Retrieve a set of rows from the database and attempt to hydrate instances of this ImpelPeer's associated ImpelClass with the results.
<span class='line'>1221</span>     * It is important to realize that doSelect and doSelectOne will only retrieve objects that are an instance of this ImpelPeer's 
<span class='line'>1222</span>     * ImpelClass. One-to-many and many-to-many relationships will not be maintaned. Use doSelectJoinAll or a similar function if
<span class='line'>1223</span>     * this ImpelClass's objects are actually made up of multiple other ImpelClasses.
<span class='line'>1224</span>     *
<span class='line'>1225</span>     * @param {Criteria} criteria - The criteria used to limit the results retrieved. The appropriate table and columns will be added
<span class='line'>1226</span>     *                            to the Criteria object automatically, so you only need to specify the pieces of the WHERE clause.
<span class='line'>1227</span>     *                            It can also be an empty criteria, so doSelect(new Criteria(), ...) is fine if you want to retireve
<span class='line'>1228</span>     *                            all of the associated objects from the database.
<span class='line'>1229</span>     *
<span class='line'>1230</span>     * @param {function} callback(ImpelClass) - The function to call when the query completes.
<span class='line'>1231</span>     * @param {connection} [con]                  - The database connection to use. Impel.db will be used if it is undefined. 
<span class='line'>1232</span>     *
<span class='line'>1233</span>     * @returns {undefined} To access the ImpelClass objects that are retreived, pass in a callback function
<span class='line'>1234</span>     *
<span class='line'>1235</span>     * @see ImpelPeer#doSelectOne
<span class='line'>1236</span>     * @see ImpelPeer#doSelectJoinAll
<span class='line'>1237</span>     */</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">   </span><span class="NAME">doSelect</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">       </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Impel.db</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"No suitable database connection found. Assign one to Impel.db"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"doSelect(criteria) requires a Criteria object"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">       
<span class='line'>1245</span>        </span><span class="NAME">con.transaction</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">transaction</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">criteria.hasSelectColumns</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1247</span> </span><span class="WHIT">                </span><span class="NAME">criteria</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addSelectColumns</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1248</span> </span><span class="WHIT">              </span><span class="COMM">//if(isEmpty(criteria.getTableNames()))</span><span class="WHIT">
<span class='line'>1249</span> </span><span class="WHIT">                </span><span class="COMM">//criteria.addTable(this.options.table);</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="WHIT">              </span><span class="NAME">this.addTable</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="WHIT">                
<span class='line'>1252</span>               </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">criteria.getSelectSQL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1253</span> </span><span class="WHIT">              </span><span class="NAME">dbug.time</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ["</span><span class="PUNC">+</span><span class="NAME">criteria.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1254</span> </span><span class="WHIT">              </span><span class="NAME">transaction.executeSql</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="PUNC">,</span><span class="NAME">criteria.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1255</span>                  </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">trans</span><span class="PUNC">,</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>1256</span>                     </span><span class="NAME">dbug.timeEnd</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ["</span><span class="PUNC">+</span><span class="NAME">criteria.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1257</span> </span><span class="WHIT">                     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">objs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1258</span> </span><span class="WHIT">                     </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ResultSet</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1259</span> </span><span class="WHIT">                       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.options.base_object</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">                        </span><span class="NAME">obj.hydrate</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">                       </span><span class="NAME">objs.push</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">                     </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="WHIT">                     </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">objs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1264</span>                  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">                 </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">/*statment error handler*/</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">               </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">             </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">/*transaction error handler*/</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">       </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1271</span>     * Retrieve a sing row from the database and attempt to hydrate an instance of this ImpelPeer's associated ImpelClass with the result.
<span class='line'>1272</span>     * It is important to realize that doSelect and doSelectOne will only retrieve objects that are an instance of this ImpelPeer's 
<span class='line'>1273</span>     * ImpelClass. One-to-many and many-to-many relationships will not be maintaned. Use doSelectJoinAll or a similar function if
<span class='line'>1274</span>     * this ImpelClass's objects are actually made up of multiple other ImpelClasses.
<span class='line'>1275</span>     *
<span class='line'>1276</span>     * @param {Criteria} criteria - The criteria used to limit the results retrieved. The appropriate table and columns will be added
<span class='line'>1277</span>     *                            to the Criteria object automatically, so you only need to specify the pieces of the WHERE clause.
<span class='line'>1278</span>     *                            It can also be an empty criteria, so doSelect(new Criteria(), ...) is fine if you want to retireve
<span class='line'>1279</span>     *                            all of the associated objects from the database.
<span class='line'>1280</span>     *
<span class='line'>1281</span>     * @param {function} callback(object) - The function to call when the query completes.
<span class='line'>1282</span>     * @param {connection} [con]                  - The database connection to use. Impel.db will be used if it is undefined. 
<span class='line'>1283</span>     *
<span class='line'>1284</span>     * @returns {undefined} To access the ImpelClass objects that are retreived, pass in a callback function
<span class='line'>1285</span>     *
<span class='line'>1286</span>     * @see ImpelPeer#doSelect
<span class='line'>1287</span>     * @see ImpelPeer#doSelectJoinAll
<span class='line'>1288</span>     */</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">   </span><span class="NAME">doSelectOne</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">       </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Impel.db</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="WHIT">         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"No suitable database connection found. Assign one to Impel.db"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1294</span> </span><span class="WHIT">         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"doSelect(criteria) requires a Criteria object"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1295</span> </span><span class="WHIT">       
<span class='line'>1296</span>        </span><span class="NAME">con.transaction</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">transaction</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1297</span> </span><span class="WHIT">             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">criteria.hasSelectColumns</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="WHIT">               </span><span class="NAME">criteria</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addSelectColumns</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1299</span> </span><span class="WHIT">             </span><span class="COMM">//if(isEmpty(criteria.getTableNames()))</span><span class="WHIT">
<span class='line'>1300</span> </span><span class="WHIT">               </span><span class="COMM">//criteria.addTable(this.options.table);</span><span class="WHIT">
<span class='line'>1301</span> </span><span class="WHIT">               </span><span class="NAME">this.addTable</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">             
<span class='line'>1303</span>              </span><span class="NAME">criteria.setLimit</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="WHIT">             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">criteria.getSelectSQL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">             </span><span class="NAME">dbug.time</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ["</span><span class="PUNC">+</span><span class="NAME">criteria.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">             </span><span class="NAME">transaction.executeSql</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="PUNC">,</span><span class="NAME">criteria.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1307</span>                  </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">trans</span><span class="PUNC">,</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>1308</span>                     </span><span class="NAME">dbug.timeEnd</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ["</span><span class="PUNC">+</span><span class="NAME">criteria.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1309</span>                     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.options.base_object</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">                      </span><span class="NAME">obj.hydrate</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ResultSet</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1311</span> </span><span class="WHIT">                    </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1312</span>                   </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>1313</span>                  </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">/*statment error handler*/</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1314</span> </span><span class="WHIT">               </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">             </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">/*transaction error handler*/</span><span class="WHIT">
<span class='line'>1316</span> </span><span class="WHIT">       </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1319</span>     * Retrieve a single object from the database, but include all of its associated objects.
<span class='line'>1320</span>     * &lt;p>&lt;strong>Important Note&lt;/strong> This method can be incredibly memory intensive if you have a lot of rows in the database. Make sure to pass in a good Criteria&lt;/p>
<span class='line'>1321</span>     * @param {Criteria} criteria - The criteria used to limit the results retrieved. The appropriate table and columns will be added
<span class='line'>1322</span>     *                            to the Criteria object automatically, so you only need to specify the pieces of the WHERE clause.
<span class='line'>1323</span>     *                            It can also be an empty criteria, so doSelect(new Criteria(), ...) is fine if you want to retireve
<span class='line'>1324</span>     *                            all of the associated objects from the database.
<span class='line'>1325</span>     *
<span class='line'>1326</span>     * @param {function} callback(object)  - The function to call when the query completes.
<span class='line'>1327</span>     * @param {connection} [con]           - The database connection to use. Impel.db will be used if it is undefined. 
<span class='line'>1328</span>     * @param {Array} except               - Do not JOIN with the peers in this array
<span class='line'>1329</span>     *
<span class='line'>1330</span>     * @returns {undefined} To access the ImpelClass object that is retreived, pass in a callback function.
<span class='line'>1331</span>     * @see ImpelPeer#retrieveByPkIdJoinAll
<span class='line'>1332</span>     */</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="WHIT">    </span><span class="NAME">doSelectOneJoinAll</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">except</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">            </span><span class="NAME">this.doSelectJoinAll</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cards</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">                                      </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">cards.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">                                      </span><span class="NAME">cards</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">                                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">except</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1340</span>      * Retrieve a single object from the database based on its primary key (id).
<span class='line'>1341</span>      * @param {Number} id      - The value of the id for the object that you want to retrieve
<span class='line'>1342</span>      *
<span class='line'>1343</span>      * @param {function} callback(object)  - The function to call when the query completes.
<span class='line'>1344</span>      * @param {connection} [con]           - The database connection to use. Impel.db will be used if it is undefined. 
<span class='line'>1345</span>      *
<span class='line'>1346</span>      * @returns {undefined} To access the ImpelClass object that is retreived, pass in a callback function.
<span class='line'>1347</span>      * @see ImpelPeer#doSelectOne
<span class='line'>1348</span>      */</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">   </span><span class="NAME">retrieveByPkId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">       </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"ImpelPeer::retireveByPkIdJoinAll requires an id argument"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">     
<span class='line'>1353</span>      </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">        </span><span class="NAME">c.add</span><span class="PUNC">(</span><span class="NAME">this.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"Peer::id"</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">     </span><span class="NAME">this.doSelectOne</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">     
<span class='line'>1357</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1359</span>     * Retrieve a single object from the database based on its primary key (id), but also retrieve its associated objects.
<span class='line'>1360</span>     * @param {Number} id      - The value of the id for the object that you want to retrieve
<span class='line'>1361</span>     *
<span class='line'>1362</span>     * @param {function} callback(object)  - The function to call when the query completes.
<span class='line'>1363</span>     * @param {connection} [con]           - The database connection to use. Impel.db will be used if it is undefined. 
<span class='line'>1364</span>     * @param {Array} except               - Do not JOIN with the peers in this array
<span class='line'>1365</span>     *
<span class='line'>1366</span>     * @returns {undefined} To access the ImpelClass object that is retreived, pass in a callback function.
<span class='line'>1367</span>     * @see ImpelPeer#doSelectOneJoinAll
<span class='line'>1368</span>     */</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="WHIT">   </span><span class="NAME">retrieveByPkIdJoinAll</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">except</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"ImpelPeer::retireveByPkIdJoinAll requires an id argument"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">      </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">      </span><span class="NAME">c.add</span><span class="PUNC">(</span><span class="NAME">this.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"Peer::id"</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">      </span><span class="NAME">this.doSelectJoinAll</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cards</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">                                      </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">cards.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">                                      </span><span class="NAME">cards</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">                                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">except</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1380</span>     * Retrieve objets of the ImpelClass that are associated with this ImpelPeer, but also retieve all the other ImpelClass objects that
<span class='line'>1381</span>     * are associated with each object for this ImpelPeer.
<span class='line'>1382</span>     *
<span class='line'>1383</span>     * @param {Criteria} criteria - The criteria used to limit the results retrieved. The appropriate table and columns will be added
<span class='line'>1384</span>     *                            to the Criteria object automatically, so you only need to specify the pieces of the WHERE clause.
<span class='line'>1385</span>     *                            It can also be an empty criteria, so doSelect(new Criteria(), ...) is fine if you want to retireve
<span class='line'>1386</span>     *                            all of the associated objects from the database.
<span class='line'>1387</span>     *
<span class='line'>1388</span>     * @param {function} callback(object)  - The function to call when the query completes.
<span class='line'>1389</span>     * @param {connection} [con]           - The database connection to use. Impel.db will be used if it is undefined. 
<span class='line'>1390</span>     * @param {Array} except               - Do not JOIN with the peers in this array
<span class='line'>1391</span>     *
<span class='line'>1392</span>     * @returns {undefined} To access the ImpelClass objects that are retreived, pass in a callback function.
<span class='line'>1393</span>     *
<span class='line'>1394</span>     * @example
<span class='line'>1395</span>     * var c = new Criteria();
<span class='line'>1396</span>     *  c.add("CardPeer::id",119);
<span class='line'>1397</span>     * CardPeer.doSelectJoinAllExcept(c,function(cards){ ... }, null, ['CardScore','Stack']);
<span class='line'>1398</span>     */</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">   </span><span class="NAME">doSelectJoinAll</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">except</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1400</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">except</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'array'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1401</span> </span><span class="WHIT">          </span><span class="NAME">except</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="WHIT">       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addTable</span><span class="PUNC">(</span><span class="NAME">this.addSelectColumns</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1403</span> </span><span class="WHIT">               </span><span class="NAME">this.has_manys.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">                 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">except.contains</span><span class="PUNC">(</span><span class="NAME">peer_column.peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">                 </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.peer.addTable</span><span class="PUNC">(</span><span class="NAME">peer_column.peer.addSelectColumns</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">                 </span><span class="NAME">c.addJoin</span><span class="PUNC">(</span><span class="NAME">this.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"Peer::id"</span><span class="PUNC">,</span><span class="NAME">peer_column.peer_name</span><span class="PUNC">+</span><span class="STRN">"::"</span><span class="PUNC">+</span><span class="NAME">peer_column.column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">               </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">               
<span class='line'>1410</span>                </span><span class="NAME">this.has_many_throughs.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">                   </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">except.contains</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">                      </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">                   </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.addTable</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.addSelectColumns</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">                   </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.addTable</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">                   </span><span class="NAME">c.addJoin</span><span class="PUNC">(</span><span class="NAME">this.options.base_object</span><span class="PUNC">+</span><span class="STRN">"Peer::id"</span><span class="PUNC">,</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer_name</span><span class="PUNC">+</span><span class="STRN">"::"</span><span class="PUNC">+</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">                   </span><span class="NAME">c.addJoin</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer_name</span><span class="PUNC">+</span><span class="STRN">"::"</span><span class="PUNC">+</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">column</span><span class="PUNC">,</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer_name</span><span class="PUNC">+</span><span class="STRN">"::"</span><span class="PUNC">+</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">               </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="WHIT">                   
<span class='line'>1419</span>                    
<span class='line'>1420</span>                           
<span class='line'>1421</span>        </span><span class="NAME">this.executeSQL</span><span class="PUNC">(</span><span class="NAME">c.getSelectSQL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">           </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">               </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">objs</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">               </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ResultSet</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">                   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT">          </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">                   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">robjs</span><span class="WHIT">        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">                   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">robj</span><span class="WHIT">         </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">                   
<span class='line'>1429</span>                    </span><span class="NAME">obj.hydrate</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">                   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">                   </span><span class="NAME">objs.include</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="WHIT">                     </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1433</span> </span><span class="WHIT">                     </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">objs.get</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">                  
<span class='line'>1435</span>                    </span><span class="NAME">this.has_manys.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1436</span> </span><span class="WHIT">                       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">except.contains</span><span class="PUNC">(</span><span class="NAME">peer_column.peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="WHIT">                          </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">                        
<span class='line'>1439</span>                         </span><span class="NAME">robj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">peer_column.peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="WHIT">                        </span><span class="NAME">robj.hydrate</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1441</span> </span><span class="WHIT">                        </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="STRN">'add'</span><span class="PUNC">+</span><span class="NAME">peer_column.peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">robj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1442</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">                   
<span class='line'>1444</span>                    </span><span class="NAME">this.has_many_throughs.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">                       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">except.contains</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">                          </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">                     
<span class='line'>1448</span>                         </span><span class="NAME">robj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">                        </span><span class="NAME">robj.hydrate</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">                        </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="STRN">'add'</span><span class="PUNC">+</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">robj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">               </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">               </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">objs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">             </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">             </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Query failed: "</span><span class="PUNC">+</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">       </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">   
<span class='line'>1459</span>    </span><span class="COMM">/**
<span class='line'>1460</span>     * Retrieve objets of the ImpelClass that are associated with this ImpelPeer, but also retieve all the other ImpelClass objects that
<span class='line'>1461</span>     * are associated with each object for this ImpelPeer.
<span class='line'>1462</span>     *
<span class='line'>1463</span>     * @param {Criteria} criteria - The criteria used to limit the results retrieved. The appropriate table and columns will be added
<span class='line'>1464</span>     *                            to the Criteria object automatically, so you only need to specify the pieces of the WHERE clause.
<span class='line'>1465</span>     *                            It can also be an empty criteria, so doSelect(new Criteria(), ...) is fine if you want to retireve
<span class='line'>1466</span>     *                            all of the associated objects from the database.
<span class='line'>1467</span>     *
<span class='line'>1468</span>     * @param {function} callback(object)  - The function to call when the query completes.
<span class='line'>1469</span>     * @param {Array} except               - Do not JOIN with the peers in this array
<span class='line'>1470</span>     * @param {connection} [con]           - The database connection to use. Impel.db will be used if it is undefined. 
<span class='line'>1471</span>     *
<span class='line'>1472</span>     * @returns {undefined} To access the ImpelClass objects that are retreived, pass in a callback function.
<span class='line'>1473</span>     *
<span class='line'>1474</span>     * @example
<span class='line'>1475</span>     * var c = new Criteria();
<span class='line'>1476</span>     *  c.add("CardPeer::id",119);
<span class='line'>1477</span>     * CardPeer.doSelectJoinAllExcept(c,function(cards){ ... }, ['CardScore','Stack']);
<span class='line'>1478</span>     */</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">   </span><span class="NAME">doSelectJoinAllExcept</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">,</span><span class="NAME">peers</span><span class="PUNC">,</span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">peers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'array'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"doSelectJoinAllExcept requires an array of peer names as an argument"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.doSelectJoinAll</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">,</span><span class="NAME">con</span><span class="PUNC">,</span><span class="NAME">peers</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1483</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">   
<span class='line'>1485</span>    </span><span class="COMM">/**
<span class='line'>1486</span>     * Define an one-to-many relationship between this ImpelPeer and another.
<span class='line'>1487</span>     * &lt;p>This ImpelPeer will be modified to include methods to select its associated ImpelClass objects from the database along with the the related 
<span class='line'>1488</span>     *     ImpelClass specified by the peer_column argument. This ImpelPeer's associated ImpelClass will also be modified to include methods for holding 
<span class='line'>1489</span>     *     the related objects.&lt;/p>
<span class='line'>1490</span>     * &lt;p>Any calls to save an ImpelClass that uses this ImpelPeer will also save any of the related objects that it has a one-to-many relationship with&lt;/p>
<span class='line'>1491</span>     *
<span class='line'>1492</span>     * @param {String} peer_column The Peer::column that relates the two ImpelPeers.
<span class='line'>1493</span>     *
<span class='line'>1494</span>     * @returns {undefined} This ImpelPeer will be modified to include new methods as will the prototype for the associated ImpelClass
<span class='line'>1495</span>     * &lt;h3>Example&lt;/h3>
<span class='line'>1496</span>     * &lt;pre class="code brush: js;">
<span class='line'>1497</span>     *   CardTablePeer.hasMany("PlayerPeer::card_table_id");
<span class='line'>1498</span>     * &lt;/pre>
<span class='line'>1499</span>     *
<span class='line'>1500</span>     * &lt;h4>This ImpelPeer (CardTablePeer) now includes the following method&lt;/h4>
<span class='line'>1501</span>     * &lt;pre class="code brush: js;">
<span class='line'>1502</span>     *   CardTablePeer.doSelectJoinPlayer(criteria,s_callback,con);
<span class='line'>1503</span>     * &lt;/pre>
<span class='line'>1504</span>     *
<span class='line'>1505</span>     * &lt;h4>The related ImpelClass (CardTable) now includes the following methods&lt;/h4>
<span class='line'>1506</span>     * &lt;pre class="code brush: js;">
<span class='line'>1507</span>     *   CardTable.addPlayer(player);
<span class='line'>1508</span>     *   CardTable.getPlayers();
<span class='line'>1509</span>     * &lt;/pre>
<span class='line'>1510</span>     *
<span class='line'>1511</span>     * @see ImpelClass#generateDocs
<span class='line'>1512</span>     */</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">   </span><span class="NAME">hasMany</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">     </span><span class="NAME">this.has_manys.set</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">peer_column</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">peer_column.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">     </span><span class="NAME">peer_column</span><span class="WHIT">                  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.has_manys</span><span class="PUNC">[</span><span class="NAME">peer_column</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">adder</span><span class="WHIT">                    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'add'</span><span class="PUNC">+</span><span class="NAME">peer_column.peer.options.base_object</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getter</span><span class="WHIT">                   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'get'</span><span class="PUNC">+</span><span class="NAME">peer_column.peer.options.base_object</span><span class="PUNC">+</span><span class="STRN">'s'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">holder</span><span class="WHIT">                   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.peer.options.base_object.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">     
<span class='line'>1520</span>      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mods</span><span class="WHIT">           </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">         </span><span class="NAME">mods</span><span class="PUNC">[</span><span class="NAME">getter</span><span class="PUNC">]</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>1522</span>            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="WHIT"> 
<span class='line'>1523</span>          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">         </span><span class="NAME">mods</span><span class="PUNC">[</span><span class="NAME">adder</span><span class="PUNC">]</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">                 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">                   </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">                 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">                   </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">                  </span><span class="COMM">// don't forget to record that it has been modified </span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">     </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.options.base_object</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">implement</span><span class="PUNC">(</span><span class="NAME">mods</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1532</span> </span><span class="WHIT">     
<span class='line'>1533</span>      
<span class='line'>1534</span>      </span><span class="COMM">/** 
<span class='line'>1535</span>       * Now add in Peer methods for retrieving with Joins.
<span class='line'>1536</span>       * For this method to work this Object must have a name equivalent with
<span class='line'>1537</span>       * this.options.base_object+Peer
<span class='line'>1538</span>       *
<span class='line'>1539</span>       */</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">method</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"doSelectJoin"</span><span class="PUNC">+</span><span class="NAME">peer_column.peer.options.base_object</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">     </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">           </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addTable</span><span class="PUNC">(</span><span class="NAME">this.addSelectColumns</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">             </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.peer.addTable</span><span class="PUNC">(</span><span class="NAME">peer_column.peer.addSelectColumns</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">             </span><span class="NAME">c.addJoin</span><span class="PUNC">(</span><span class="NAME">this.options.base_object</span><span class="PUNC">+</span><span class="STRN">"Peer::id"</span><span class="PUNC">,</span><span class="NAME">peer_column.peer_name</span><span class="PUNC">+</span><span class="STRN">"::"</span><span class="PUNC">+</span><span class="NAME">peer_column.column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">             </span><span class="NAME">this.executeSQL</span><span class="PUNC">(</span><span class="NAME">c.getSelectSQL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">                 </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">                   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">objs</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">                   </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ResultSet</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">                       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT">          </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.options.base_object</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">                       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">robj</span><span class="WHIT">         </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">peer_column.peer.options.base_object</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">                       </span><span class="NAME">obj.hydrate</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">                       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">                       </span><span class="NAME">objs.include</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">                         </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">                         </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">objs.get</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">                       </span><span class="NAME">robj.hydrate</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">                       </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">adder</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">robj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">                   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1559</span> </span><span class="WHIT">                   </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">objs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">                 </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">                 </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Query failed: "</span><span class="PUNC">+</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">             </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">       
<span class='line'>1563</span>      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1566</span>     * Define a many-to-many relationship between this ImpelPeer and another via a third ImpelPeer.
<span class='line'>1567</span>     * &lt;p>This ImpelPeer will be modified to include methods to select its associated ImpelClass objects from the database along with the the related 
<span class='line'>1568</span>     *    ImpelClass specified by the peer_column argument. This ImpelPeer's associated ImpelClass will also be modified to include methods for holding 
<span class='line'>1569</span>     *    the related objects.&lt;/p>
<span class='line'>1570</span>     * &lt;p>Any calls to save an ImpelClass that uses this ImpelPeer will also save any of the related objects that it has a many-to-many relationship with.
<span class='line'>1571</span>     *    The save call will also keep the association up to date via the third ImpelPeer&lt;/p>
<span class='line'>1572</span>     *
<span class='line'>1573</span>     * @param {String} peer_column The Peer::column that this ImpelPeer has a many-to-many relationship with.
<span class='line'>1574</span>     * @param {String} through_peer_column The Peer::column that associates this Peer with the third Peer
<span class='line'>1575</span>     * @param {String} through_peer_column_relation The peer::column that associates the related Peer with the third Peer
<span class='line'>1576</span>     *
<span class='line'>1577</span>     * @returns {undefined} This ImpelPeer will be modified to include new methods as will the prototype for the associated ImpelClass
<span class='line'>1578</span>     * &lt;h3>Example&lt;/h3>
<span class='line'>1579</span>     * &lt;pre class="code brush: js;">
<span class='line'>1580</span>     *   CardPeer.hasManyThrough("StackPeer::id", "CardStackPeer::card_id", "CardStackPeer::stack_id");
<span class='line'>1581</span>     * &lt;/pre>
<span class='line'>1582</span>     *
<span class='line'>1583</span>     * &lt;h4>The ImpelPeer (CardPeer) now includes the following method&lt;/h4>
<span class='line'>1584</span>     * &lt;pre class="code brush: js;">
<span class='line'>1585</span>     *   CardPeer.doSelectJoinStackThroughCardStack(criteria,s_callback,con);
<span class='line'>1586</span>     * &lt;/pre>
<span class='line'>1587</span>     *
<span class='line'>1588</span>     * &lt;h4>The related ImpelClass (CardTable) now includes the following methods&lt;/h4>
<span class='line'>1589</span>     * &lt;pre class="code brush: js;">
<span class='line'>1590</span>     *   Card.addStack(stack);
<span class='line'>1591</span>     *   Card.getStacks();
<span class='line'>1592</span>     * &lt;/pre>
<span class='line'>1593</span>     *
<span class='line'>1594</span>     * &lt;p>The Card.doSelectJoinAll method will take the many-to-many relationship between CardPeer and StackPeer into account; as will the Card.save() method.&lt;/p>
<span class='line'>1595</span>     * &lt;br />
<span class='line'>1596</span>     * &lt;p>Currently, you must manually specify both sides of the many-to-many relationship, so in our example we need to call StackPeer.hasManyThrough as well.&lt;/p>
<span class='line'>1597</span>     * &lt;pre class="code brush: js;">
<span class='line'>1598</span>     *   StackPeer.hasManyThrough("CardPeer::id", "CardStackPeer::stack_id", "CardStackPeer::card_id");
<span class='line'>1599</span>     * &lt;/pre>
<span class='line'>1600</span>     *
<span class='line'>1601</span>     * &lt;h4>The ImpelPeer (StackPeer) now includes the following method&lt;/h4>
<span class='line'>1602</span>     * &lt;pre class="code brush: js;">
<span class='line'>1603</span>     *   StackPeer.doSelectJoinStackThroughCardStack(criteria,s_callback,con);
<span class='line'>1604</span>     * &lt;/pre>
<span class='line'>1605</span>     *
<span class='line'>1606</span>     * &lt;h4>The related ImpelClass (Stack) now includes the following methods&lt;/h4>
<span class='line'>1607</span>     * &lt;pre class="code brush: js;">
<span class='line'>1608</span>     *   Stack.addCard(card);
<span class='line'>1609</span>     *   Stack.getCards();
<span class='line'>1610</span>     * &lt;/pre>
<span class='line'>1611</span>     *
<span class='line'>1612</span>     * @see ImpelClass#generateDocs
<span class='line'>1613</span>     */</span><span class="WHIT">
<span class='line'>1614</span> </span><span class="WHIT">   </span><span class="NAME">hasManyThrough</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">,</span><span class="NAME">through_peer_column</span><span class="PUNC">,</span><span class="NAME">through_peer_column_relation</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">skey</span><span class="WHIT">                        </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">through_peer_column</span><span class="PUNC">+</span><span class="STRN">","</span><span class="PUNC">+</span><span class="NAME">through_peer_column_relation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">      </span><span class="NAME">this.has_many_throughs.set</span><span class="PUNC">(</span><span class="NAME">skey</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">peer_column.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">through_peer_column.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">through_peer_column_relation.parsePeerColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">      </span><span class="NAME">peer_column</span><span class="WHIT">                     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.has_many_throughs</span><span class="PUNC">[</span><span class="NAME">skey</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">      </span><span class="NAME">through_peer_column</span><span class="WHIT">             </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.has_many_throughs</span><span class="PUNC">[</span><span class="NAME">skey</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">      </span><span class="NAME">through_peer_column_relation</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.has_many_throughs</span><span class="PUNC">[</span><span class="NAME">skey</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">      
<span class='line'>1621</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">adder</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'add'</span><span class="PUNC">+</span><span class="NAME">peer_column.peer.options.base_object</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'get'</span><span class="PUNC">+</span><span class="NAME">peer_column.peer.options.base_object</span><span class="PUNC">+</span><span class="STRN">'s'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">holder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.peer.options.base_object.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1624</span> 
<span class='line'>1625</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mods</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">          </span><span class="NAME">mods</span><span class="PUNC">[</span><span class="NAME">getter</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">          </span><span class="NAME">mods</span><span class="PUNC">[</span><span class="NAME">adder</span><span class="PUNC">]</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">                  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">                    </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1630</span> </span><span class="WHIT">                  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">                    </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">holder</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">                 </span><span class="COMM">// don't forget to record that it has been modified </span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">      </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.options.base_object</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">implement</span><span class="PUNC">(</span><span class="NAME">mods</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1635</span> 
<span class='line'>1636</span> </span><span class="WHIT">      </span><span class="COMM">/** 
<span class='line'>1637</span>        * Now add in Peer methods for retrieving with JoinThroughs.
<span class='line'>1638</span>        * For this method to work this Object must have a name equivalent with
<span class='line'>1639</span>        * this.options.base_object+Peer
<span class='line'>1640</span>        */</span><span class="WHIT">
<span class='line'>1641</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">method</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"doSelectJoin"</span><span class="PUNC">+</span><span class="NAME">peer_column.peer.options.base_object</span><span class="PUNC">+</span><span class="STRN">"Through"</span><span class="PUNC">+</span><span class="NAME">through_peer_column.peer.options.base_object</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="WHIT">      </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">criteria</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">              </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addTable</span><span class="PUNC">(</span><span class="NAME">this.addSelectColumns</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">criteria</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">                  </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peer_column.peer.addTable</span><span class="PUNC">(</span><span class="NAME">peer_column.peer.addSelectColumns</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="WHIT">                  </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">through_peer_column.peer.addTable</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">                  </span><span class="NAME">c.addJoin</span><span class="PUNC">(</span><span class="NAME">this.options.base_object</span><span class="PUNC">+</span><span class="STRN">"Peer::id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">through_peer_column.peer_name</span><span class="PUNC">+</span><span class="STRN">"::"</span><span class="PUNC">+</span><span class="NAME">through_peer_column.column</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CritConstants.LEFT_JOIN</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">                  </span><span class="NAME">c.addJoin</span><span class="PUNC">(</span><span class="NAME">peer_column.peer_name</span><span class="PUNC">+</span><span class="STRN">"::"</span><span class="PUNC">+</span><span class="NAME">peer_column.column</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">through_peer_column_relation.peer_name</span><span class="PUNC">+</span><span class="STRN">"::"</span><span class="PUNC">+</span><span class="NAME">through_peer_column_relation.column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">              
<span class='line'>1649</span>               </span><span class="NAME">this.executeSQL</span><span class="PUNC">(</span><span class="NAME">c.getSelectSQL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1650</span> </span><span class="WHIT">                  </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">objs</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">                    </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ResultSet</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toArray</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1653</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT">          </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.options.base_object</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1654</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">robj</span><span class="WHIT">         </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">peer_column.peer.options.base_object</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="WHIT">                        </span><span class="NAME">obj.hydrate</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1656</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1657</span> </span><span class="WHIT">                        </span><span class="NAME">objs.include</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="WHIT">                          </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">                          </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">objs.get</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">                        </span><span class="NAME">robj.hydrate</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">                        </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">adder</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">robj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">                    </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">objs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">                  </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Query failed: "</span><span class="PUNC">+</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">              </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1669</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1670</span>     * Determine if Impel is currently deleting an ImpelClass with a specific id.
<span class='line'>1671</span>     * &lt;p>This method is used by Impel to prevent certain race-conditions. It can be used externally, but there should be no need.&lt;/p>
<span class='line'>1672</span>     *
<span class='line'>1673</span>     * @param {Number} id The id of the ImpelClass object to check.
<span class='line'>1674</span>     */</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">   </span><span class="NAME">isDeleting</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'number'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.deleting_ids.contains</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1681</span>     * Record that an ImpelClass object has been deleted.
<span class='line'>1682</span>     * &lt;p>This method is used by Impel to prevent certain race-conditions. It can be used externally, but there should be no need.&lt;/p>
<span class='line'>1683</span>     *
<span class='line'>1684</span>     * @param {Number} id The id of the ImpelClass object
<span class='line'>1685</span>     */</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">   </span><span class="NAME">setDeleted</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'number'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.deleting_ids.erase</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1690</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1692</span>     * Record that an ImpelClass object is being deleted.
<span class='line'>1693</span>     * &lt;p>This method is used by Impel to prevent certain race-conditions. It can be used externally, but there should be no need.&lt;/p>
<span class='line'>1694</span>     *
<span class='line'>1695</span>     * @param {Number} id The id of the ImpelClass object
<span class='line'>1696</span>     */</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">   </span><span class="NAME">setDeleting</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="WHIT">     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'number'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.deleting_ids.push</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1701</span>    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">   
<span class='line'>1703</span>    </span><span class="COMM">/**
<span class='line'>1704</span>     * Generate a documentation page for this object detailing all of it's doSelectJoin* methods, which are automatically generated.
<span class='line'>1705</span>     * &lt;p>&lt;strong>Important Note:&lt;/strong> The documentation does include the method definitons, but they cannot be copied verbatim 
<span class='line'>1706</span>     * into your code and substituted for the actual automatically generated methods. &lt;/p>
<span class='line'>1707</span>     *
<span class='line'>1708</span>     * @returns {String} A jsdoc-toolkit formatted string of declarations
<span class='line'>1709</span>     *
<span class='line'>1710</span>     * &lt;pre class="code brush: js;">
<span class='line'>1711</span>     * /&#x2a;&#x2a;
<span class='line'>1712</span>     *  * Retrieve objects from the database including their associated Compound m-m 
<span class='line'>1713</span>     *  * objects using CardCompound as an intermediary. 
<span class='line'>1714</span>     *  * @param   {Criteria} criteria The Criteria object to use to construct and limit 
<span class='line'>1715</span>     *  *                              the query. 
<span class='line'>1716</span>     *  * @param   {function} callback(Objects[]) The function to pass the results to 
<span class='line'>1717</span>     *  * @param   {Database} [con] The database connection to use.
<span class='line'>1718</span>     *  * @returns {undefined} The callback function will be used to pass the results back
<span class='line'>1719</span>     *  &#x2a;/
<span class='line'>1720</span>     * doSelectJoinCompoundThroughCardCompound : function (criteria, callback, con) {
<span class='line'>1721</span>     *     var c = this.addTable(this.addSelectColumns( criteria));
<span class='line'>1722</span>     *         c = peer_column.peer.addTable(peer_column.peer.addSelectColumns(c));
<span class='line'>1723</span>     *         c = through_peer_column.peer.addTable(c);
<span class='line'>1724</span>     *         c.addJoin(this.options.base_object+"Peer::id", through_peer_column.peer_name + "::" + through_peer_column.column, CritConstants.LEFT_JOIN);
<span class='line'>1725</span>     *         c.addJoin(peer_column.peer_name + "::" + peer_column.column, through_peer_column_relation.peer_name + "::" + through_peer_column_relation.column);
<span class='line'>1726</span>     *
<span class='line'>1727</span>     *     this.executeSQL(c.getSelectSQL(),c.getValues(),
<span class='line'>1728</span>     *           function(rs){
<span class='line'>1729</span>     *             var objs   = $H({});
<span class='line'>1730</span>     *             new ResultSet(rs).toArray().each(function(row){
<span class='line'>1731</span>     *                 var obj     = new window[this.options.base_object]();
<span class='line'>1732</span>     *                 var robj    = new window[peer_column.peer.options.base_object]();
<span class='line'>1733</span>     *                     obj.hydrate(row);
<span class='line'>1734</span>     *
<span class='line'>1735</span>     *                 var id      = obj.getId();
<span class='line'>1736</span>     *                     objs.include(id,obj);
<span class='line'>1737</span>     *                     obj         = null;
<span class='line'>1738</span>     *                     obj         = objs.get(id);
<span class='line'>1739</span>     *
<span class='line'>1740</span>     *                 robj.hydrate(row);
<span class='line'>1741</span>     *                 obj[adder](robj);
<span class='line'>1742</span>     *              },this);
<span class='line'>1743</span>     *            callback(objs);
<span class='line'>1744</span>     *         }.bind(this),
<span class='line'>1745</span>     *         function(e){ 
<span class='line'>1746</span>     *            throw("Query failed: "+e); 
<span class='line'>1747</span>     *         }
<span class='line'>1748</span>     *     );
<span class='line'>1749</span>     * }
<span class='line'>1750</span>     * &lt;/pre>
<span class='line'>1751</span>     * @see ImpelClass#generateDocs
<span class='line'>1752</span>     */</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">   </span><span class="NAME">generateDocs</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">,</span><span class="NAME">getters</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">         </span><span class="NAME">getters</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">         </span><span class="NAME">jsdoc</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">     </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">mem</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">       </span><span class="COMM">// we can use hasOwnProperty here because Peers are instantiations whereas ImpelClasses are new classes.</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">       </span><span class="COMM">// the former has its signature modfied while the latter has its prototype modified.</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">mem</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">        </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">       </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mem.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="STRN">"doSelectJoin"</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">mem</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'doSelectJoinAll'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mem</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'doSelectJoinAllExcept'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mem.contains</span><span class="PUNC">(</span><span class="STRN">"doSelectJoin"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">             </span><span class="NAME">getters.push</span><span class="PUNC">(</span><span class="NAME">mem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1767</span> 
<span class='line'>1768</span> </span><span class="WHIT">     </span><span class="NAME">getters.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">getter</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">getter.contains</span><span class="PUNC">(</span><span class="STRN">"Through"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">         </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getter.substring</span><span class="PUNC">(</span><span class="STRN">"doSelectJoin"</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">,</span><span class="NAME">getter.indexOf</span><span class="PUNC">(</span><span class="STRN">"Through"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  
<span class='line'>1771</span>          </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getter.substring</span><span class="PUNC">(</span><span class="NAME">getter.indexOf</span><span class="PUNC">(</span><span class="STRN">"Through"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"Through"</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">,</span><span class="NAME">getter.length</span><span class="PUNC">)</span><span class="WHIT">       
<span class='line'>1772</span>          </span><span class="NAME">jsdoc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n\n/**\n * Retrieve objects from the database including their associated "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">" m-m objects using "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">" as an intermediary. \n * @param {Criteria} criteria The Criteria object to use to construct and limit the query. \n * @param {function} callback(Objects[]) The function to pass the results to \n * @param {Database} [con] The database connection to use.\n * @returns {undefined} The callback function will be used to pass the results back\n */\n"</span><span class="PUNC">+</span><span class="NAME">getter</span><span class="PUNC">+</span><span class="STRN">" : "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">getter</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">         </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getter.substring</span><span class="PUNC">(</span><span class="STRN">"doSelectJoin"</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">,</span><span class="NAME">getter.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="WHIT">         </span><span class="NAME">jsdoc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n\n/**\n * Retrieve objects from the database including their associated "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">" 1-m objects.\n * @param {Criteria} criteria The Criteria object to use to construct and limit the query. \n * @param {function} callback(Objects[]) The function to pass the results to \n * @param {Database} [con] The database connection to use.\n * @returns {undefined} The callback function will be used to pass the results back\n */\n"</span><span class="PUNC">+</span><span class="NAME">getter</span><span class="PUNC">+</span><span class="STRN">" : "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">getter</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1776</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1777</span> 
<span class='line'>1778</span> </span><span class="WHIT">     </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1779</span> 
<span class='line'>1780</span> 
<span class='line'>1781</span> </span><span class="WHIT">     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsdoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1782</span> </span><span class="WHIT">   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT"> 
<span class='line'>1785</span>  
<span class='line'>1786</span> 
<span class='line'>1787</span> </span><span class="COMM">/**
<span class='line'>1788</span>  * Any class of objects that is to be persisted via Impel must Extend the ImpelClass, contain a 'peer_class' attribute,
<span class='line'>1789</span>  * and be within the scope of window. 
<span class='line'>1790</span>  *
<span class='line'>1791</span>  * &lt;p>Your classes can have any attributes or methods that you want, but only attributes that are defined in the column 
<span class='line'>1792</span>  * object of the associated peer class will be persisted. If you define a toString method the result of that
<span class='line'>1793</span>  * method will be used when your object is used in String context.&lt;/p>
<span class='line'>1794</span>  *
<span class='line'>1795</span>  * &lt;p>Every instance of ImpelClass and it's inheritors must have an associated and instantiated ImpelPeer. The Peer object
<span class='line'>1796</span>  * defines the attributes ImpelClass that will be persisted along with where in the database they will be saved.&lt;/p>
<span class='line'>1797</span>  *
<span class='line'>1798</span>  * &lt;ul>
<span class='line'>1799</span>  *  &lt;lh>&lt;strong>Important Notes:&lt;/strong>&lt;/lh>
<span class='line'>1800</span>  *  &lt;li>The ImpelPeer object must be declared after the ImpelClass class.&lt;/li>
<span class='line'>1801</span>  *  &lt;li>Unlike ImpelPeer, ImpelClass should not be directly instantiated. Instead you should create another class that extends ImpelClass&lt;/li>
<span class='line'>1802</span>  *  &lt;li>Define the member attributes of this class, that will be persisted, through an associated instance of ImpelPeer.&lt;/li>
<span class='line'>1803</span>  *  &lt;li>Member attributes defined via an ImpelPeer will automatically be accessible by get and set methods. If you want to override the getters
<span class='line'>1804</span>  *      and setters then define one ImpelClass along with an ImpelPeer then define another ImpelClass that extends the first. If you don't your
<span class='line'>1805</span>  *      customizations will be overwritten.&lt;/li>
<span class='line'>1806</span>  *  &lt;li>You must define the peer_class member manually.&lt;/li>
<span class='line'>1807</span>  * &lt;/ul>
<span class='line'>1808</span>  *
<span class='line'>1809</span>  * @see ImpelPeer
<span class='line'>1810</span>  *
<span class='line'>1811</span>  * @example
<span class='line'>1812</span>      var Card = new Class({
<span class='line'>1813</span>                           Extends       : ImpelClass,
<span class='line'>1814</span>                           peer_class    : "CardPeer",
<span class='line'>1815</span>                           toString      : function(){
<span class='line'>1816</span>                                             return this.getKanji();
<span class='line'>1817</span>                                           }
<span class='line'>1818</span>                 });
<span class='line'>1819</span> 
<span class='line'>1820</span>      var CardPeer = new ImpelPeer({
<span class='line'>1821</span>                           'columns'     :   { 
<span class='line'>1822</span>                                               'id'          : 'card.id', 
<span class='line'>1823</span>                                               'kanji'       : 'card.kanji', 
<span class='line'>1824</span>                                               'hatsuon'     : 'card.hatsuon',
<span class='line'>1825</span>                                               'meaning'     : 'card.meaning', 
<span class='line'>1826</span>                                               'level'       : 'card.level', 
<span class='line'>1827</span>                                               'created_at'  : 'card.created_at',
<span class='line'>1828</span>                                               'updated_at'  : 'card.updated_at'
<span class='line'>1829</span>                                              },
<span class='line'>1830</span>                           'table'         : 'card',
<span class='line'>1831</span>                           'base_object'   : 'Card'
<span class='line'>1832</span>                    }); 
<span class='line'>1833</span>  *
<span class='line'>1834</span>  * @class ImpelClass
<span class='line'>1835</span>  */</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ImpelClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Class</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">  </span><span class="NAME">Implements</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">Options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Events</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">  </span><span class="NAME">options</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">  </span><span class="NAME">attributes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">  </span><span class="NAME">is_new</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">  </span><span class="NAME">modified_columns</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">  </span><span class="NAME">is_deleted</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">  </span><span class="NAME">is_deleting</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">  </span><span class="NAME">is_saving</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1846</span>    * @param {Object} options Options to bind to this ImpelClass object. Currently no configurable Options are supported by this class.
<span class='line'>1847</span>    * @param {Object} events Events to bind to to this ImpelClass object. Currently no Events are fired by this class
<span class='line'>1848</span>    */</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">  </span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="NAME">events</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">    
<span class='line'>1850</span>     </span><span class="NAME">this.setOptions</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">    </span><span class="NAME">this.addEvents</span><span class="PUNC">(</span><span class="NAME">events</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1854</span>    * Retrieve the Peer object from memory.
<span class='line'>1855</span>    */</span><span class="WHIT">
<span class='line'>1856</span> </span><span class="WHIT">  </span><span class="NAME">getPeer</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1857</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.peer_class</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1858</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1860</span>    * After the base peer saves the object to the database it wil call this method on the saved object with 
<span class='line'>1861</span>    * an SQLResultSet, that *should* contain the id of the newly inserted row.
<span class='line'>1862</span>    * &lt;p>We check for the id, update ourselves with it and take ourselves out of the saving state.&lt;/p>
<span class='line'>1863</span>    *
<span class='line'>1864</span>    * @param {SQLResultSet} rs - The result set returned by the database query
<span class='line'>1865</span>    *
<span class='line'>1866</span>    * @see ImpelPeer#executeSQL
<span class='line'>1867</span>    * @see ImpelClass#saveOnlyMe
<span class='line'>1868</span>    */</span><span class="WHIT">
<span class='line'>1869</span> </span><span class="WHIT">  </span><span class="NAME">updateIdFromRS</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1870</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isNew</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">          </span><span class="NAME">this.attributes.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rs.insertId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">          </span><span class="NAME">this.is_new</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">          </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"Failed to save the new object into the database. Did you manually call isNew(false)? Don't do that"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1876</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1877</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1878</span> </span><span class="WHIT">    
<span class='line'>1879</span>     </span><span class="NAME">this.is_saving</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="WHIT">    
<span class='line'>1881</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">rs.rowsAffected</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1882</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.is_deleted</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1883</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Can't update or insert and object that has been deleted"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1884</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"INSERT or UPDATE seems to have failed."</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1888</span> 
<span class='line'>1889</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1890</span>    * Save this object, but don't bother saving any related objects. 
<span class='line'>1891</span>    * &lt;p>If the object is new use an INSERT statement, but if it is not use an UPDATE statement. Also don't bother with
<span class='line'>1892</span>    * attributes that haven't been set.&lt;/p>
<span class='line'>1893</span>    *
<span class='line'>1894</span>    * &lt;p>If the object contains an updated_at or created_at member they will automatically be set to the appropriate time&lt;/p>
<span class='line'>1895</span>    *
<span class='line'>1896</span>    *
<span class='line'>1897</span>    * @param {function} [s_callback(object ResultSet)=null]  - The callback to use if the save is succesful
<span class='line'>1898</span>    * @param {function} [f_callback(string error)=null]      - The callback to use if the save is not successful
<span class='line'>1899</span>    *
<span class='line'>1900</span>    * @see ImpelClass.save
<span class='line'>1901</span>    * @see Criteria#getInsertSQL
<span class='line'>1902</span>    * @see Criteria#getUpdateSQL
<span class='line'>1903</span>    */</span><span class="WHIT">
<span class='line'>1904</span> </span><span class="WHIT">  </span><span class="NAME">saveOnlyMe</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s_callback</span><span class="PUNC">,</span><span class="NAME">f_callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1905</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.is_deleted</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.peer_class</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isDeleting</span><span class="PUNC">(</span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1906</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Can't save an object that has been, or is being deleted: "</span><span class="PUNC">+</span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1907</span> </span><span class="WHIT">    </span><span class="NAME">this.is_saving</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="WHIT">    
<span class='line'>1909</span>     </span><span class="COMM">// only INSERT/UPDATE attributes that have been modified</span><span class="WHIT">
<span class='line'>1910</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">crit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1911</span> </span><span class="WHIT">    </span><span class="NAME">this.modified_columns.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1912</span> </span><span class="WHIT">        </span><span class="NAME">crit.add</span><span class="PUNC">(</span><span class="NAME">this.peer_class</span><span class="PUNC">+</span><span class="STRN">"::"</span><span class="PUNC">+</span><span class="NAME">column</span><span class="PUNC">,</span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">column</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1913</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="WHIT">    
<span class='line'>1915</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1916</span> </span><span class="WHIT">    
<span class='line'>1917</span>     </span><span class="COMM">// this next section in particular is dubious</span><span class="WHIT">
<span class='line'>1918</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isNew</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>1919</span>       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="STRN">'created_at'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">        </span><span class="NAME">this.setCreatedAt</span><span class="PUNC">(</span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="WHIT">      </span><span class="NAME">stmt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">crit.getInsertSQL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1922</span>     </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1923</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">isEmpty</span><span class="PUNC">(</span><span class="NAME">this.attributes.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">          </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Objects must have a defined id attribute before they can be updated."</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="STRN">'updated_at'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">          </span><span class="NAME">this.setUpdatedAt</span><span class="PUNC">(</span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">          
<span class='line'>1928</span>         </span><span class="NAME">constraintCrit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">          </span><span class="NAME">constraintCrit.add</span><span class="PUNC">(</span><span class="NAME">this.peer_class</span><span class="PUNC">+</span><span class="STRN">"::id"</span><span class="PUNC">,</span><span class="NAME">this.attributes.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1930</span> </span><span class="WHIT">          
<span class='line'>1931</span>         </span><span class="NAME">stmt</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">crit.getUpdateSQL</span><span class="PUNC">(</span><span class="NAME">constraintCrit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1933</span> </span><span class="WHIT">    
<span class='line'>1934</span>     </span><span class="COMM">/** 
<span class='line'>1935</span>      * Execute the SQL statement and have the Peer call this object's updateIdFromRS method when complete. We also
<span class='line'>1936</span>      * pass on the callbacks that were passed to us. 
<span class='line'>1937</span>      */</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="WHIT">    </span><span class="NAME">this.getPeer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">executeSQL</span><span class="PUNC">(</span><span class="NAME">stmt</span><span class="PUNC">,</span><span class="NAME">crit.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">s_callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f_callback</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'updateIdFromRS'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="WHIT">    </span><span class="COMM">// what happens if stmt is null?</span><span class="WHIT">
<span class='line'>1940</span> </span><span class="WHIT">    
<span class='line'>1941</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1942</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>1943</span>    * Save any objects that have a one-to-many relationship with this one.
<span class='line'>1944</span>    * &lt;p>Use the Peer's list of one-to-many relationships to access this objects get method for one-to-many objects.
<span class='line'>1945</span>    * Iterate over the list of objects and update any of them that don't have our id, i.e. aren't recorded as 
<span class='line'>1946</span>    * being related to this object.&lt;/p>
<span class='line'>1947</span>    *
<span class='line'>1948</span>    * @param {function} [s_callback(object ResultSet)=null]  - The callback to use if the save is succesful
<span class='line'>1949</span>    * @param {function} [f_callback(string error)=null]      - The callback to use if the save is not successful
<span class='line'>1950</span>    *
<span class='line'>1951</span>    * @see ImpelClass.saveMtoMObjsandLink
<span class='line'>1952</span>    *
<span class='line'>1953</span>    */</span><span class="WHIT">
<span class='line'>1954</span> </span><span class="WHIT">  </span><span class="NAME">saveOneToManyObjs</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s_callback</span><span class="PUNC">,</span><span class="NAME">f_callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1955</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isNew</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1956</span> </span><span class="WHIT">          </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"saveOneToManyObjs cannot be called until this object has been saved"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1957</span> </span><span class="WHIT">      
<span class='line'>1958</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dobjsToSave</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">      </span><span class="NAME">this.getPeer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">has_manys.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">peer_column</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">           </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dobjs</span><span class="WHIT">          </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">'get'</span><span class="PUNC">+</span><span class="NAME">peer_column.peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"s"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">           </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dobjs</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>1962</span>              </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1963</span> </span><span class="WHIT">           </span><span class="COMM">// now we check to see if they have our id saved into them</span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">           </span><span class="COMM">// but we need to know which attribute holds our id</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">           </span><span class="COMM">// CardPeer.hasMany("CardScorePeer::card_id");</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">           </span><span class="NAME">dobjs.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dobj</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">               </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dobj</span><span class="PUNC">[</span><span class="NAME">peer_column.getter</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">                  </span><span class="NAME">dobj</span><span class="PUNC">[</span><span class="NAME">peer_column.setter</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">               </span><span class="COMM">// we want to save objects that aren't associated, but we also want to save</span><span class="WHIT">
<span class='line'>1970</span> </span><span class="WHIT">               </span><span class="COMM">// any, already associated objects, that have been modified </span><span class="WHIT">
<span class='line'>1971</span> </span><span class="WHIT">               </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dobj.isModified</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="WHIT">                   </span><span class="NAME">dobjsToSave.push</span><span class="PUNC">(</span><span class="NAME">dobj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1973</span> </span><span class="WHIT">           </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1974</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1975</span> </span><span class="WHIT">      </span><span class="COMM">// these functions should be replaced by a method in this object that keeps track of which ones failed and which ones succeeded</span><span class="WHIT">
<span class='line'>1976</span> </span><span class="WHIT">      </span><span class="NAME">dobjsToSave.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dobj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">dobj.save</span><span class="PUNC">(</span><span class="NAME">$empty</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Failed to save dependent object. Database error:"</span><span class="PUNC">+</span><span class="NAME">e.message</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1977</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1978</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1979</span>    * Save any related many-to-many objects along with the link between this object and them.
<span class='line'>1980</span>    * &lt;p>If this object was new then there is no possibility that the joining table has an entry for this object and
<span class='line'>1981</span>    * it's related objects, so we must save the link. The related object may not have been previously saved though.
<span class='line'>1982</span>    * If the related object is new then it won't have an id so we can't save the connecting object until after 
<span class='line'>1983</span>    * we've saved it.&lt;/p>
<span class='line'>1984</span>    *
<span class='line'>1985</span>    * &lt;p>If this object was not new then it is possible that a link already exists in the database between it and its
<span class='line'>1986</span>    * related objects. We have to check for that link before creating new ones.&lt;/p>
<span class='line'>1987</span>    *
<span class='line'>1988</span>    * @param {function} [s_callback(object ResultSet)=null]  - The callback to use if the save is succesful
<span class='line'>1989</span>    * @param {function} [f_callback(string error)=null]      - The callback to use if the save is not successful
<span class='line'>1990</span>    * @param {boolean} wasNew  - Inidicates that this object was new before calling this method. If this parameter is not accurate then the database could become inconsistent
<span class='line'>1991</span>    *
<span class='line'>1992</span>    * @see ImpelClass#saveOneToManyObjs
<span class='line'>1993</span>    */</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">  </span><span class="NAME">saveMtoMObjsandLink</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s_callback</span><span class="PUNC">,</span><span class="NAME">f_callback</span><span class="PUNC">,</span><span class="NAME">wasNew</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1995</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isNew</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1996</span> </span><span class="WHIT">          </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"saveMtoMObjsandLink cannot be called until this object has been saved"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">saving</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">slept</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">      
<span class='line'>2000</span>       </span><span class="NAME">this.getPeer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">has_many_throughs.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="WHIT">              </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dobjs</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">'get'</span><span class="PUNC">+</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'s'</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dobjs</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2003</span> </span><span class="WHIT">                  </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2004</span> </span><span class="WHIT">              </span><span class="NAME">dobjs.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dobj</span><span class="PUNC">,</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">                  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">                      </span><span class="NAME">connection</span><span class="PUNC">[</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setter</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">                  
<span class='line'>2008</span>                   </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dobj.isNew</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">                          </span><span class="NAME">saving</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="WHIT">                          </span><span class="NAME">dobj.save</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">                              </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>2012</span>                                     </span><span class="NAME">connection</span><span class="PUNC">[</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setter</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">rs.insertId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>2013</span>                                     </span><span class="NAME">connection.save</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">saving</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"database error: "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>2014</span>                                   </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>2015</span>                                       </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Saved m-m dependent object, but failed to save connection between them:"</span><span class="PUNC">+</span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>2016</span>                                   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">                          </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Failed to save m-m dependent object, will not save connection object:"</span><span class="PUNC">+</span><span class="NAME">e.message</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2019</span> </span><span class="WHIT">                      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">wasNew</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2020</span> </span><span class="WHIT">                          </span><span class="NAME">saveing</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2021</span> </span><span class="WHIT">                          </span><span class="NAME">connection</span><span class="PUNC">[</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setter</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">dobj.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2022</span> </span><span class="WHIT">                          </span><span class="NAME">connection.save</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">save</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Database error: "</span><span class="PUNC">+</span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2024</span> </span><span class="WHIT">                          </span><span class="COMM">/*
<span class='line'>2025</span>                            * If neither object was/is New then it is possible that there is an entry in the joining table,
<span class='line'>2026</span>                            * so we need to check for one before creating it.
<span class='line'>2027</span>                            */</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">                           </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2029</span> </span><span class="WHIT">                              </span><span class="NAME">c.add</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">orig</span><span class="PUNC">,</span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2030</span> </span><span class="WHIT">                              </span><span class="NAME">c.add</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">orig</span><span class="PUNC">,</span><span class="NAME">dobj</span><span class="PUNC">[</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getter</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">                              </span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.doSelectOne</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>2032</span>                                   </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">                                      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">                                          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">peer.getBaseObjName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">                                              </span><span class="NAME">connection</span><span class="PUNC">[</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setter</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">                                              </span><span class="NAME">connection</span><span class="PUNC">[</span><span class="NAME">rel</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setter</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">dobj.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">                                              </span><span class="NAME">saving</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">                                              </span><span class="NAME">connection.save</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">save</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Database error: "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">                                  </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">                      </span><span class="COMM">// if dobj is modified we need to save it, but we can concurrently save the connection because</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">                      </span><span class="COMM">// dobj is not new and therefore already has an id</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">                      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">dobj.isModified</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">                          </span><span class="NAME">dobj.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">              
<span class='line'>2048</span>       </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">      
<span class='line'>2050</span>       </span><span class="COMM">/** 
<span class='line'>2051</span>        * This is unfortunate, but the only way we know when we've finished saving everything is to wait. It's a bit of a game
<span class='line'>2052</span>        * to figure out the best amount of time to wait during each iteration. It's also risky in that the code above must
<span class='line'>2053</span>        * be rock solid with regards to incrementing and decrementing the saving counter.
<span class='line'>2054</span>        */</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">saveCheck</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">slept</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">saving</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">            </span><span class="NAME">s_callback</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">          </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">slept</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2059</span> </span><span class="WHIT">            </span><span class="NAME">f_callback</span><span class="PUNC">(</span><span class="STRN">"Failed to save all m-m related objects"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2060</span> </span><span class="WHIT">          </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">            </span><span class="NAME">this.delay</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">            </span><span class="NAME">slept</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">          
<span class='line'>2064</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2065</span> </span><span class="WHIT">      </span><span class="NAME">saveCheck.delay</span><span class="PUNC">(</span><span class="NUMB">50</span><span class="PUNC">,</span><span class="NAME">saveCheck</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2066</span> </span><span class="WHIT">      
<span class='line'>2067</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2069</span>    * Has this object been modified since it was last retreived from the database
<span class='line'>2070</span>    */</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">  </span><span class="NAME">isModified</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.modified_columns.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2075</span>    * Persist this object in the database or update the appropriate database row to reflect changes in this object since it was last instantiated.
<span class='line'>2076</span>    * &lt;p>If there are other objects associated with this one via 1-m and m-m relationships they will be automatically saved/updated if necessary.&lt;/p>
<span class='line'>2077</span>    * &lt;p>If the object contains an updated_at or created_at member they will automatically be set to the appropriate time&lt;/p>
<span class='line'>2078</span>    *
<span class='line'>2079</span>    * @param {function} [s_callback({Object} ResultSet)=null]  - The callback to use if the save is succesful
<span class='line'>2080</span>    * @param {function} [f_callback({String} error)=null]      - The callback to use if the save is not successful
<span class='line'>2081</span>    *
<span class='line'>2082</span>    * @see ImpelClass#saveOnlyMe
<span class='line'>2083</span>    */</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="WHIT">  </span><span class="NAME">save</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s_callback</span><span class="PUNC">,</span><span class="NAME">f_callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2085</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">s_callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2086</span> </span><span class="WHIT">        </span><span class="NAME">s_callback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$empty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2087</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">f_callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2088</span> </span><span class="WHIT">        </span><span class="NAME">f_callback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$empty</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2089</span> </span><span class="WHIT">      
<span class='line'>2090</span>       </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isNew</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2091</span> </span><span class="WHIT">          </span><span class="NAME">this.saveOnlyMe</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2092</span> </span><span class="WHIT">              </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2093</span> </span><span class="WHIT">                  </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="WHIT">                      </span><span class="NAME">this.saveOneToManyObjs</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2095</span> </span><span class="WHIT">                        </span><span class="COMM">// the m-to-m save is setup to fire the callback only after all the necessary saves have occured</span><span class="WHIT">
<span class='line'>2096</span> </span><span class="WHIT">                        </span><span class="COMM">// if the 1-m save takes longer than the m-m we can end up with a race condition...</span><span class="WHIT">
<span class='line'>2097</span> </span><span class="WHIT">                      </span><span class="NAME">this.saveMtoMObjsandLink</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">s_callback</span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">$empty</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2098</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2099</span> </span><span class="WHIT">                      </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Failed to save dependent objects: "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2100</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2101</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2102</span> </span><span class="WHIT">              </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2103</span> </span><span class="WHIT">                  </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"Failed to save base object: "</span><span class="PUNC">+</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2104</span> </span><span class="WHIT">                  </span><span class="NAME">f_callback</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2105</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2106</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2107</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isModified</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2108</span> </span><span class="WHIT">            </span><span class="NAME">this.saveOnlyMe</span><span class="PUNC">(</span><span class="NAME">s_callback</span><span class="PUNC">,</span><span class="NAME">f_callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2109</span> </span><span class="WHIT">          </span><span class="COMM">// we can call saveDeps at the same time as saveOnlyMe because we are not new and therefore have a DB id</span><span class="WHIT">
<span class='line'>2110</span> </span><span class="WHIT">          </span><span class="COMM">// so saveDeps will still work</span><span class="WHIT">
<span class='line'>2111</span> </span><span class="WHIT">          </span><span class="NAME">this.saveOneToManyObjs</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2112</span> </span><span class="WHIT">          </span><span class="NAME">this.saveMtoMObjsandLink</span><span class="PUNC">(</span><span class="NAME">$empty</span><span class="PUNC">,</span><span class="NAME">$empty</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2113</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2114</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2115</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2116</span>    * Mark this object as having been deleted, so that it cannot be saved or updated. This, hopefully, eliminates at least one class of race condition.
<span class='line'>2117</span>    */</span><span class="WHIT">
<span class='line'>2118</span> </span><span class="WHIT">  </span><span class="NAME">removed</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2119</span> </span><span class="WHIT">    </span><span class="NAME">this.is_deleted</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2120</span> </span><span class="WHIT">    </span><span class="NAME">this.getPeer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setDeleted</span><span class="PUNC">(</span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2121</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2122</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2123</span>    * Remove this object from the database
<span class='line'>2124</span>    * &lt;p>Tell the Peer that this object is being removed, so that it cannot be saved by another process, delete it and then mark it as deleted, so that it cannot be used.
<span class='line'>2125</span>    * The object still exists in memory though ...&lt;/p>
<span class='line'>2126</span>    *
<span class='line'>2127</span>    * @param {function} [s_callback({Object} ResultSet)=null]  - The callback to use if the remove is succesful
<span class='line'>2128</span>    * @param {function} [f_callback({String} error)=null]      - The callback to use if the remove is not successful   
<span class='line'>2129</span>    */</span><span class="WHIT">
<span class='line'>2130</span> </span><span class="WHIT">  </span><span class="NAME">remove</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s_callback</span><span class="PUNC">,</span><span class="NAME">f_callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2131</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.is_saving</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2132</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Can't remove object because it is currently being saved. "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2133</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2134</span> </span><span class="WHIT">        
<span class='line'>2135</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isNew</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2136</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="PUNC">(</span><span class="STRN">"Object does not exist in the database"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">    
<span class='line'>2139</span>     </span><span class="NAME">this.getPeer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setDeleting</span><span class="PUNC">(</span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2140</span> </span><span class="WHIT">    
<span class='line'>2141</span>     
<span class='line'>2142</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">crit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Criteria</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2143</span> </span><span class="WHIT">      </span><span class="NAME">crit.add</span><span class="PUNC">(</span><span class="NAME">this.peer_class</span><span class="PUNC">+</span><span class="STRN">"::id"</span><span class="PUNC">,</span><span class="NAME">this.getId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2144</span> </span><span class="WHIT">    </span><span class="NAME">this.getPeer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">executeSQL</span><span class="PUNC">(</span><span class="NAME">crit.getDeleteSQL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">crit.getValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">s_callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f_callback</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'removed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2145</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2146</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2147</span>    * Convert an array of columns:values retrieved from the database into attributes of this object.
<span class='line'>2148</span>    * &lt;p>When a SELECT statement is executed on two tables that contain a column with the same name the column name will be prepended with a the table name and a period, e.g., [table.]column.
<span class='line'>2149</span>    * We need to strip off that table name specifier and use only the column name as an attribute. It is also possibe that the results of the query could include columns that are not a 
<span class='line'>2150</span>    * part of this class, so we check if the table matches our peer's table name before using the column.&lt;/p>
<span class='line'>2151</span>    *
<span class='line'>2152</span>    * @param {Object} attrs - The column/value pairs retrieved from the database
<span class='line'>2153</span>    */</span><span class="WHIT">
<span class='line'>2154</span> </span><span class="WHIT">  </span><span class="NAME">hydrate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2155</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newAttrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="WHIT">    </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getKeys</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2157</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">key.contains</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2158</span> </span><span class="WHIT">          </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key.split</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">          </span><span class="NAME">klass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key.split</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2160</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">klass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.peer_class</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getTableName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2161</span> </span><span class="WHIT">            </span><span class="NAME">newAttrs</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="WHIT">       </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">newAttrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2164</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2165</span> </span><span class="WHIT">    
<span class='line'>2166</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">newAttrs.id</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">this.peer_class</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isDeleting</span><span class="PUNC">(</span><span class="NAME">newAttrs.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2167</span> </span><span class="WHIT">      </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Can't hydrate object because it is currently being deleted from the database."</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2168</span> </span><span class="WHIT">    
<span class='line'>2169</span>     </span><span class="NAME">this.setAttributes</span><span class="PUNC">(</span><span class="NAME">newAttrs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2170</span> </span><span class="WHIT">    </span><span class="NAME">this.is_new</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2171</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2172</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2173</span>    * Take a list of JSON objects and convert it into attributes for this object. The attributes will be accessible via 
<span class='line'>2174</span>    * camelCase named getters, e.g., updated_at is accessible via the getUpdatedAt method.
<span class='line'>2175</span>    *
<span class='line'>2176</span>    * This method should really only be called internally via the hydrate method.
<span class='line'>2177</span>    *
<span class='line'>2178</span>    * @param {Object} attrs 
<span class='line'>2179</span>    */</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">  </span><span class="NAME">setAttributes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2181</span> </span><span class="WHIT">    </span><span class="NAME">this.attributes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$merge.run</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">this.attributes</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">extend</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2182</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2183</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2184</span>    * 
<span class='line'>2185</span>    * This is a vestigial method that should be removed as it exists verbatim in the parent class.
<span class='line'>2186</span>    * @param {Object} options
<span class='line'>2187</span>    */</span><span class="WHIT">
<span class='line'>2188</span> </span><span class="WHIT">  </span><span class="NAME">setOptions</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2189</span> </span><span class="WHIT">    </span><span class="NAME">this.parent</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2190</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2191</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2192</span>    * Generate a string representing this object's attributes and their current values.
<span class='line'>2193</span>    * @method getDbug
<span class='line'>2194</span>    */</span><span class="WHIT">
<span class='line'>2195</span> </span><span class="WHIT">  </span><span class="NAME">getDbug</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2196</span> </span><span class="WHIT">    </span><span class="NAME">dbg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2197</span> </span><span class="WHIT">    </span><span class="NAME">$H</span><span class="PUNC">(</span><span class="NAME">this.attributes</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getKeys</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2198</span> </span><span class="WHIT">      </span><span class="NAME">dbg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" : "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.attributes</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2199</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2200</span> </span><span class="WHIT">    </span><span class="NAME">dbg</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"isNew: "</span><span class="PUNC">+</span><span class="NAME">this.isNew</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2201</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dbg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2202</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2203</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2204</span>    * Log the this objects attributes to the console.
<span class='line'>2205</span>    *
<span class='line'>2206</span>    * @method dbug
<span class='line'>2207</span>    */</span><span class="WHIT">
<span class='line'>2208</span> </span><span class="WHIT">  </span><span class="NAME">dbug</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2209</span> </span><span class="WHIT">    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">this.getDbug</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2210</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2211</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>2212</span>    * Set this object to new or retireve its current state.
<span class='line'>2213</span>    * If only javascript class methods could be made private ....
<span class='line'>2214</span>    *
<span class='line'>2215</span>    * @param boolean b - If b is defined and is a boolean this objects new status will be set to the value of b.
<span class='line'>2216</span>    *
<span class='line'>2217</span>    * @method isNew
<span class='line'>2218</span>    */</span><span class="WHIT">
<span class='line'>2219</span> </span><span class="WHIT">  </span><span class="NAME">isNew</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2220</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'boolean'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2221</span> </span><span class="WHIT">      </span><span class="NAME">this.is_new</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2222</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.is_new</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2223</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="WHIT">  
<span class='line'>2225</span>   </span><span class="COMM">/**
<span class='line'>2226</span>    * Generate a documentation page for this object detailing all of it's get and set methods, which are automatically generated
<span class='line'>2227</span>    * by the peer. This method should only be called on a new object.
<span class='line'>2228</span>    * &lt;p>&lt;strong>Important Note:&lt;/strong> The documentation does include the method definitons, but they cannot be copied verbatim 
<span class='line'>2229</span>    * into your code and substituted for the actual automatically generated methods. &lt;/p>
<span class='line'>2230</span>    *
<span class='line'>2231</span>    * @returns {String} A jsdoc-toolkit formatted string of declarations
<span class='line'>2232</span>    *
<span class='line'>2233</span>    * &lt;pre class="code brush: js;">
<span class='line'>2234</span>    *  /&#x2a;&#x2a;
<span class='line'>2235</span>    *   * @param   {mixed} v The value to set the corresponding internal meaning attribute
<span class='line'>2236</span>    *   * @returns {undefined}
<span class='line'>2237</span>    *   &#x2a;/
<span class='line'>2238</span>    *   setMeaning : function (v) { 
<span class='line'>2239</span>    *                  this.attributes[attr] = v;
<span class='line'>2240</span>    *                  this.modified_columns.push(attr);
<span class='line'>2241</span>    *                }
<span class='line'>2242</span>    *
<span class='line'>2243</span>    *  /&#x2a;&#x2a;
<span class='line'>2244</span>    *   * Retrieve the corresponding internal level attribute
<span class='line'>2245</span>    *   * @returns {mixed} The corresponding internal attribute
<span class='line'>2246</span>    *   &#x2a;/
<span class='line'>2247</span>    *   getLevel : function () { 
<span class='line'>2248</span>    *                  return this.attributes[attr]; 
<span class='line'>2249</span>    *               }
<span class='line'>2250</span>    *
<span class='line'>2251</span>    *  /&#x2a;&#x2a;
<span class='line'>2252</span>    *   * Add an associated 1-m or m-m Stack object to object 
<span class='line'>2253</span>    *   * @returns {undefined} 
<span class='line'>2254</span>    *   &#x2a;/
<span class='line'>2255</span>    *   addStack : function (obj) {
<span class='line'>2256</span>    *                 if(this.attributes[holder] == null)
<span class='line'>2257</span>    *                    this.attributes[holder] = [];
<span class='line'>2258</span>    *                 if(this.attributes[holder][obj.getId()] == null)
<span class='line'>2259</span>    *                   this.attributes[holder].push(obj);
<span class='line'>2260</span>    *              }
<span class='line'>2261</span>    *
<span class='line'>2262</span>    *  /&#x2a;&#x2a;
<span class='line'>2263</span>    *   * Retrieve the associated 1-m or m-m Stack objects from this object's internal 
<span class='line'>2264</span>    *   * storage; Not the database.
<span class='line'>2265</span>    *   * @returns {Stack[]} An array of the associated objects 
<span class='line'>2266</span>    *   &#x2a;/
<span class='line'>2267</span>    *   getStacks : function () { 
<span class='line'>2268</span>                  return this.attributes[holder] 
<span class='line'>2269</span>                }
<span class='line'>2270</span>    * &lt;/pre>   
<span class='line'>2271</span>    
<span class='line'>2272</span>    
<span class='line'>2273</span>    * @see ImpelPeer#generateDocs
<span class='line'>2274</span>    */</span><span class="WHIT">
<span class='line'>2275</span> </span><span class="WHIT">  </span><span class="NAME">generateDocs</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2276</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">,</span><span class="NAME">jsdoc</span><span class="PUNC">,</span><span class="NAME">setters</span><span class="PUNC">,</span><span class="NAME">getters</span><span class="PUNC">,</span><span class="NAME">adders</span><span class="PUNC">,</span><span class="NAME">mmadders</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2277</span> </span><span class="WHIT">        </span><span class="NAME">getters</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2278</span> </span><span class="WHIT">        </span><span class="NAME">setters</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2279</span> </span><span class="WHIT">        </span><span class="NAME">adders</span><span class="WHIT">    </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2280</span> </span><span class="WHIT">        </span><span class="NAME">mmgetters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2281</span> </span><span class="WHIT">        </span><span class="NAME">jsdoc</span><span class="WHIT">     </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2282</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">mem</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="WHIT">      </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mem.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'get'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'set'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'add'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mem</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'setOptions'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mem</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'setAttributes'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mem</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'getDbug'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mem</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'addEvents'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mem</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'addEvent'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mem</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'getPeer'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2285</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mem.charAt</span><span class="PUNC">(</span><span class="NAME">mem.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'s'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2286</span> </span><span class="WHIT">            </span><span class="NAME">mmgetters.push</span><span class="PUNC">(</span><span class="NAME">mem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2287</span> </span><span class="WHIT">          </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'set'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2288</span> </span><span class="WHIT">            </span><span class="NAME">setters.push</span><span class="PUNC">(</span><span class="NAME">mem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2289</span> </span><span class="WHIT">          </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'get'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2290</span> </span><span class="WHIT">            </span><span class="NAME">getters.push</span><span class="PUNC">(</span><span class="NAME">mem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2291</span> </span><span class="WHIT">          </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'add'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2292</span> </span><span class="WHIT">            </span><span class="NAME">adders.push</span><span class="PUNC">(</span><span class="NAME">mem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2293</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="WHIT">    
<span class='line'>2296</span>     </span><span class="NAME">setters.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">setter</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2297</span> </span><span class="WHIT">      </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setter.substring</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NAME">setter.length</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2298</span> </span><span class="WHIT">      </span><span class="NAME">jsdoc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n\n/**\n * @param {mixed} v The value to set the corresponding internal "</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">+</span><span class="STRN">" attribute\n * @returns {undefined}\n */\n"</span><span class="PUNC">+</span><span class="NAME">setter</span><span class="PUNC">+</span><span class="STRN">" : "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">setter</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2299</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2300</span> </span><span class="WHIT">    
<span class='line'>2301</span>     </span><span class="NAME">getters.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">getter</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2302</span> </span><span class="WHIT">      </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getter.substring</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NAME">getter.length</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2303</span> </span><span class="WHIT">      </span><span class="NAME">jsdoc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n\n/**\n * Retrieve the corresponding internal "</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">+</span><span class="STRN">" attribute\n * @returns {mixed} The corresponding internal attribute\n */\n"</span><span class="PUNC">+</span><span class="NAME">getter</span><span class="PUNC">+</span><span class="STRN">" : "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">getter</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">   
<span class='line'>2306</span>     </span><span class="NAME">adders.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">adder</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">      </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adder.substring</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NAME">adder.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">      </span><span class="NAME">jsdoc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n\n/**\n * Add an associated 1-m or m-m "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">" object to object \n * @returns {undefined} \n */\n"</span><span class="PUNC">+</span><span class="NAME">adder</span><span class="PUNC">+</span><span class="STRN">" : "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">adder</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">   
<span class='line'>2311</span>     </span><span class="NAME">mmgetters.each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mmgetter</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2312</span> </span><span class="WHIT">      </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mmgetter.substring</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NAME">mmgetter.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">      </span><span class="NAME">jsdoc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n\n/**\n * Retrieve the associated 1-m or m-m "</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="STRN">" objects from this object's internal storage. &lt;strong>Not the database&lt;/strong> \n * @returns {"</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">+</span><span class="STRN">"[]} An array of the associated objects \n */\n"</span><span class="PUNC">+</span><span class="NAME">mmgetter</span><span class="PUNC">+</span><span class="STRN">" : "</span><span class="PUNC">+</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">mmgetter</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2315</span> </span><span class="WHIT">   
<span class='line'>2316</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsdoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2317</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span></pre></body></html>