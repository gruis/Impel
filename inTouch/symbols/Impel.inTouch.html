<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="generator" content="JsDoc Toolkit" />

		<title>Impel HTML 5 Javascript ORM - Impel.inTouch</title>

        <link rel="stylesheet" type="text/css" href="../../css/impel-unyui.css" />
        <link rel="stylesheet" type="text/css" href="../../css/sh/shCore.css" />
        <link rel="stylesheet" type="text/css" href="../../css/sh/shThemeDjango.css" />
        <script type="text/javascript" src="../../js/sh/shCore.js"></script>
        <script type="text/javascript" src="../../js/sh/shBrushJScript.js"></script>
        <script type="text/javascript" src="../../js/sh/shBrushJScript.js"></script>
        <script type="text/javascript">SyntaxHighlighter.defaults["toolbar"]=true; SyntaxHighlighter.defaults["tab-size"]=2; SyntaxHighlighter.all();</script>

	</head>

	<body>
<!-- ============================== header ================================= -->
		<!-- begin static/header.html -->
		<div id="header">
</div>
		<!-- end static/header.html -->

<!-- ============================== classes index ============================ -->
		<div id="index">
			<!-- begin publish.classesIndex -->
			<div align="center"><a href="../index.html">Class Index</a>
        </div>
<hr />
<h2>Classes</h2>
<ul class="classList">



	<li><a href="../symbols/Impel.inTouch.html">Impel.inTouch</a></li>

</ul>
<hr />
			<!-- end publish.classesIndex -->
		</div>

		<div id="content">
<!-- ============================== class title ============================ -->
			<h1 class="classTitle">

				Class Impel.inTouch
			</h1>

<!-- ============================== class summary ========================== -->
			<p class="description">





					<br /><i>Defined in: </i> <a href="../symbols/src/src_impel.inTouch-source.js.html">impel.inTouch-source.js</a>.

			</p>

<!-- ============================== constructor summary ==================== -->

			<table class="summaryTable" cellspacing="0" summary="A summary of the constructor documented in the class Impel.inTouch.">
				<caption>Class Summary</caption>
				<thead>
					<tr>
						<th scope="col">Constructor Attributes</th>
						<th scope="col">Constructor Name and Description</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td class="attributes">&nbsp;</td>
						<td class="nameDescription" >
							<div class="fixedFont">
								<b><a href="../symbols/Impel.inTouch.html">Impel.inTouch</a></b>(options, events)
							</div>
							<div class="description">Keep a local  HTML5 SQL database in sync with one published by your server.</div>
						</td>
					</tr>
				</tbody>
			</table>


<!-- ============================== properties summary ===================== -->



				<table class="summaryTable" cellspacing="0" summary="A summary of the fields documented in the class Impel.inTouch.">
					<caption>Field Summary</caption>
					<thead>
						<tr>
							<th scope="col">Field Attributes</th>
							<th scope="col">Field Name and Description</th>
						</tr>
					</thead>
					<tbody>

						<tr>
							<td class="attributes">&lt;static&gt; &nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont">
								Impel.inTouch.<b><a href="../symbols/Impel.inTouch.html#.options.baseURL">options.baseURL</a></b>
								</div>
								<div class="description">The url where Impel.inTouch can find the versions and table definition files.</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&lt;static&gt; &nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont">
								Impel.inTouch.<b><a href="../symbols/Impel.inTouch.html#.options.displayName">options.displayName</a></b>
								</div>
								<div class="description">A human-friendly name for the database</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&lt;static&gt; &nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont">
								Impel.inTouch.<b><a href="../symbols/Impel.inTouch.html#.options.maxSize">options.maxSize</a></b>
								</div>
								<div class="description">The maximum size that this database can grow to</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&lt;static&gt; &nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont">
								Impel.inTouch.<b><a href="../symbols/Impel.inTouch.html#.options.name">options.name</a></b>
								</div>
								<div class="description">The name of the local database to use</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&lt;static&gt; &nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont">
								Impel.inTouch.<b><a href="../symbols/Impel.inTouch.html#.options.tableFileSuffix">options.tableFileSuffix</a></b>
								</div>
								<div class="description">The suffix of the files on the server that include the import/update data</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&lt;static&gt; &nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont">
								Impel.inTouch.<b><a href="../symbols/Impel.inTouch.html#.options.versionsFile">options.versionsFile</a></b>
								</div>
								<div class="description">The name of the file on the server that details the currently published tables and their versions</div>
							</td>
						</tr>

					</tbody>
				</table>





<!-- ============================== methods summary ======================== -->



				<table class="summaryTable" cellspacing="0" summary="A summary of the methods documented in the class Impel.inTouch.">
					<caption>Method Summary</caption>
					<thead>
						<tr>
							<th scope="col">Method Attributes</th>
							<th scope="col">Method Name and Description</th>
						</tr>
					</thead>
					<tbody>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#checkForUpdates">checkForUpdates</a></b>(table_versions)
								</div>
								<div class="description">Check the server to see if the tables have been updated recently and call synchronize for any that have been updated.</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#getVersion">getVersion</a></b>(table)
								</div>
								<div class="description">Determine which version a particular local table is currently at.</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#importData">importData</a></b>(data)
								</div>
								<div class="description">Import a new version of a table into the local database.</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#loadVersions">loadVersions</a></b>(s_callback)
								</div>
								<div class="description">Check the local database to determine the current versions of all local tables.</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#setVersion">setVersion</a></b>(table, version)
								</div>
								<div class="description">Record that a particular table is at a particular version, and persist the record into the database.</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#sync">sync</a></b>(list)
								</div>
								<div class="description">Synchronize the local tables with those published by the server.</div>
							</td>
						</tr>

					</tbody>
				</table>




<!-- ============================== events summary ======================== -->



				<table class="summaryTable" cellspacing="0" summary="A summary of the events documented in the class Impel.inTouch.">
					<caption>Event Summary</caption>
					<thead>
						<tr>
							<th scope="col">Event Attributes</th>
							<th scope="col">Event Name and Description</th>
						</tr>
					</thead>
					<tbody>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onAborted">onAborted</a></b>(code)
								</div>
								<div class="description">The sync was aborted due to a network error
 <ul>
   <lh>Codes</lh>
   <li>1 : The versions file could not be retrieved.</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onCreated">onCreated</a></b>(table)
								</div>
								<div class="description">The portion of the update meant to create the local table succeeded</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onCreateFailed">onCreateFailed</a></b>(table, error)
								</div>
								<div class="description">The portion of the update meant to create the local table failed</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onReady">onReady</a></b>()
								</div>
								<div class="description">The Impel.inTouch object has been initialized, you can now call sync or any other method.</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onSynced">onSynced</a></b>()
								</div>
								<div class="description">The local database has been fully synchronized with the server</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onSyncFailed">onSyncFailed</a></b>(failed)
								</div>
								<div class="description">One or more of the local tables was not synchronized with the server</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onSyncing">onSyncing</a></b>()
								</div>
								<div class="description">Synchronization has begun</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onUpdated">onUpdated</a></b>(table, old, now)
								</div>
								<div class="description">A particular table has been updated</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onUpdateFailed">onUpdateFailed</a></b>(table, now, future)
								</div>
								<div class="description">A particular table was not updated</div>
							</td>
						</tr>

						<tr>
							<td class="attributes">&nbsp;</td>
							<td class="nameDescription">
								<div class="fixedFont"><b><a href="../symbols/Impel.inTouch.html#event:onUpdating">onUpdating</a></b>(table)
								</div>
								<div class="description">A particular table is now being updated</div>
							</td>
						</tr>

					</tbody>
				</table>





<!-- ============================== constructor details ==================== -->

			<div class="details"><a name="constructor"> </a>
				<div class="sectionTitle">
					Class Detail
				</div>

				<div class="fixedFont">
						<b>Impel.inTouch</b>(options, events)
				</div>

				<div class="description">
					Keep a local  HTML5 SQL database in sync with one published by your server.
<p>Impel.inTouch is used by the forthcoming HTML5 Javascript ORM, Impel, but you can use it separately without any trouble</p>



<h2>Using Impel.inTouch</h2>
<p>Impel.inTouch makes it simple to keep your client's HTML5 databases up-to-date. The first time it is used on a client's computer it will connect to your server, download the latest schema and data then import it into the local HTML5 database. Every other time the client connects to your site, or loads a cached version of it, Impel.inTouch will quickly verify that it has the latest schema and data then pass off to the rest of your web application. All you need to do to update the HTML5 databases on your client's machines is update the schema published by your server. All your client's will download the new data the very next time they fire up your web application.</p>
<p>It's all completely transparent to your clients and painless for you.</p>
<p>You do need to do a little bit of preparation though.</p>
<ul>
 <li>Setup a versions file on the server</li>
 <li>Setup a table definition file for each table that should be imported/updated by the client</li>
 <li>Include Impel.inTouch in an html file and instantiate it</li>
</ul>

<p>Tables can be updated in one of two ways:</p>
 <ol>
   <li>Single Update: no matter what the current version of the table is it will be updated to the absolute latest version.</li>
   <li>Incremental Update: the table will be updated to the next most recent version then the next most recent, and so on until it is at the latest version.</li>
 </ol>

<h3>Setup a versions file</h3>
 <p>The versions file contains a JSON encoded array of objects that define the tables and their versions. The array has to be enclosed in a function call to Impel.JsonP.callback. The callback name (Impel.JsonP.callback) will also be specified as part of the query string. By default the versions file is named versions.json.php, but you can change that when you instantiate an Impel.inTouch object.</p>
 <p>If you want the table to be updated in a single request then its entry in the versions file must consist of a table key and a <em>version</em> key. The version key's value should simply be the most recent version number.</p>
 <p>If you want the table to be updated incrementally then its entry in the versions file must consist of a table key and a <em>versions</em> key. The versions key's value should be an array of ALL the versions of the table.</p>
<pre>versions.json.php</pre>
<pre class="code brush: js;">

Impel.JsonP.callback([{ "table" : "card",         "version" : 1},
                         { "table" : "stack",        "version" : 1},
                         { "table" : "similar_card", "version" : 1},
                         { "table" : "card_score",   "version" : 1},
                         { "table" : "player",     "versions" : [1,2,3,4,5,6,7]},
                         ]);
</pre>


<h3>Setup table definition file(s)</h3>
<p>Every table that you want to have created/updated on your client's browser must have an associated definition file. The file must have the same name as the table in the versions file. By default the suffix for the table file should be .json.php, but you can specify a different suffix when you instantiate an Impel.inTouch object.</p>
<p><strong>Important note </strong> If a table is to be updated incrementally rather than in a single update the name of the table and the suffix must be seperated by "_[table_version]" for each version of the table. So in the example above, where the player table has seven versions, we would need seven files: palyer_1.json.php, palyer_2.json.php, player_3.json.php, etc.,. </p>

<p>Each table definition file must contain a JSON encoded object as an argument to a call to Impel.JsonP.callback. The callback name (Impel.JsonP.callback) will also be specified as part of the request's query string. The object may include six key/value pairs; four of which (create, data, pre-create, and extra) are optional. The rest, (version, and table) are required, but for your update to have any effect you will need to define either <em>create</em>, or <em>data</em></p>
<ul>
	<li><span class="type">{String}</span> <span class="param">table</span> The name of the table</li>
	<li><span class="type">{Int}</span> <span class="param">version</span> The version of table and its data</li>
	<li><span class="type">{String[]}</span> [<span class="param">pre-create</span>] An array of SQL statements to execute before going on to the create string</li>
	<li><span class="type">{String}</span> [<span class="param">create</span>] An SQL statement used to create the table</li>
	<li><span class="type">{String[]}</span> [<span class="param">extra</span>] An array of SQL statements used to modify the table after it has been created, but before data has been loaded</li>
	<li><span class="type">{String[]}</span> [<span class="param">data</span>] Array of INSERT, UPDATE, or DELETE statements used to fill the table</li>
</ul>
<pre>card.json.php:</pre>
<pre class="code brush: js;">

Impel.JsonP.callback({
  "version" : 1,
  "table": "card",
  "pre-create" : ["DROP TABLE IF EXISTS `card`"],
  "create": "CREATE TABLE IF NOT EXISTS `card` (`id` INTEGER PRIMARY KEY, `kanji` varchar(255) default NULL, `hatsuon` varchar(255) default NULL, `meaning` varchar(255) default NULL, `level` int(11) default NULL, `created_at` datetime default NULL, `updated_at` datetime default NULL);",

  "extra" : ["CREATE INDEX IF NOT EXISTS card_I_1 ON card(kanji);",
             "CREATE INDEX IF NOT EXISTS card_I_2 ON card(hatsuon);"],

  "data" : ["INSERT INTO `card` VALUES(119, '席', 'せき', 'seat; ones place; meeting place; hall; meeting', 2, '2009-02-28 06:44:13', '2009-03-02 01:28:51');",
           　"INSERT INTO `card` VALUES(120, '印', 'いん,じるし', 'mark; imprint; sign; seal; stamp', 2, '2009-02-28 06:44:14', '2009-02-28 06:44:14');"]
  });
</pre>


<pre>player_6.json.php:</pre>
<pre class="code brush: js;">

Impel.JsonP.callback({
  "version" : 6,
  "table": "player",
  "data" : ["INSERT INTO `player` VALUES(760, 'Bugssy Two-Tone', '2009-01-21 16:47:13');",
            "INSERT INTO `player` VALUES(761, 'Bill Brass-Knuckles Malone', '2009-01-22 13:22:56');"]
  });
</pre>

<pre>player_7.json.php:</pre>
<pre class="code brush: js;">

Impel.JsonP.callback({
  "version" : 7,
  "table": "player",
  "data" : ["INSERT INTO `player` VALUES(762, 'Johnny Good', '2009-02-28 06:44:13');",
            "INSERT INTO `player` VALUES(763, 'Tommy Big', '2009-02-28 11:24:06');"]
  });
</pre>




<h3>Include and Instantiate Impel.inTouch</h3>
 <p>Impel requires Mootools 1.2+. Other than that all you need to do is include the Impel.inTouch library in a script tag, and instantiate an Impel.inTouch object with the baseURL option. The baseURL can be remote or a relative directory, so http://my.server.co.jp/inTouch/ will work as will inTouch/. </p>
 <p>Instantiation is a two step process. First the object must determine which versions of the tables are currently setup on the client. Once that is done it will fire a 'ready' event. At that point all you have to do is call sync(). Once synchronization is finished it will fire a 'synced' event. Various events will be fired during the synchronization process to give you a better idea of what is going on and what errors (if any) occurred. Consult the API documentation for a full list.</p>
<pre class="code brush: js;">
&lt;script type="text/javascript" src="/js/impel.inTouch.js"></script>

&lt;script type="text/javascript">
 //...
  var storage = new Impel.inTouch({
      baseURL  : 'http://my.server.co.jp/inTouch/',
      onReady  : function(){
                  notify("synchronizing storage...");
                  notify("This may take to 2 minutes; please be patient.");
                  storage.sync();
                 },
      onUpdated  : function(table,oldV,newV){ notify("table "+ table + " (v"+oldV+") updated to v"+newV); },
      onUpdating : function(table){ notify("syncing "+table+" with the server"); },
      onSynced   : function(){ notify("sync is complete") },
      onAbort       : function(code){
                                if(code == 1){
                                    if(!localStorage.getItem("loadedOnce"))
                                        notify.showError("Unable initialize data. You will not be able to use KanjiTastic until the initial data has been loaded.")
                                }
                            },
      onSyncFailed : function(failures){ notify("sync failed for: " + failures); },
      onCreateFailed : function(t,e){ notify("Table creation failed for " + t + ": " + e); }
     });
 //...
&lt;/script>
</pre>

				</div>





						<dl class="detailList">
						<dt class="heading">Parameters:</dt>

							<dt>
								<span class="light fixedFont">{Object}</span>  <b>options</b>

							</dt>
								<dd><ul>
 <li><span class="type">{String}</span> <span class="param">baseURL</span>=<span class="dfvalue">null</span> <span class="required">Required</span> The url where Impel.inTouch can find the versions and table definition files. It does not have to be on the same server that provides the rest of your JavaScript.</li>
 <li><span class="type">{String}</span> [<span class="param">versionsFile</span>=<span class="dfvalue">versions.json.php</span>] The name of the file on the server that details the currently published tables and their versions</li>
 <li><span class="type">{String}</span> [<span class="param">tableFileSuffix</span>=<span class="dfvalue">.json.php</span>] The suffix of the files on the server that include the import/update data</li>
 <li><span class="type">{String}</span> [<span class="param">name</span>=<span class="dfvalue">Impel_inTouch</span>] The name of the local database to use</li>
 <li><span class="type">{String}</span> [<span class="param">displayName</span>=<span class="dfvalue">Impel inTouch</span>] A human-friendly name for the database</li>
 <li><span class="type">{Number}</span> [<span class="param">maxSize</span>=<span class="dfvalue">4096</span>] The maximum size that this database can grow to</li>
</ul></dd>

							<dt>
								<span class="light fixedFont">{Object}</span>  <b>events</b>

							</dt>
								<dd><ul>
   <li><a href="#event:onReady">ready</a></li>
   <li><a href="#event:onCreated">created</a></li>
   <li><a href="#event:onCreateFailed">createFailed</a></li>
   <li><a href="#event:onSynced">synced</a></li>
   <li><a href="#event:onSyncing">syncing</a></li>
   <li><a href="#event:onSyncFailed">syncFailed</a></li>
   <li><a href="#event:onUpdated">updated</a></li>
   <li><a href="#event:onUpdating">updating</a></li>
   <li><a href="#event:onUpdateFailed">updateFailed</a></li>
 </ul></dd>

						</dl>







						<dl class="detailList">
						<dt class="heading">See:</dt>

							<dd><a href="http://mootools.net/">http://mootools.net/</a></dd>

						</dl>


			</div>


<!-- ============================== field details ========================== -->

				<div class="sectionTitle">
					Field Detail
				</div>

					<a name=".options.baseURL"> </a>
					<div class="fixedFont">&lt;static&gt;

					<span class="light">{String}</span>
					<span class="light">Impel.inTouch.</span><b>options.baseURL</b>

					</div>
					<div class="description">
						The url where Impel.inTouch can find the versions and table definition files. It does not have to be on the same server that provides the rest of your JavaScript


					</div>








					<hr />

					<a name=".options.displayName"> </a>
					<div class="fixedFont">&lt;static&gt;

					<span class="light">{String}</span>
					<span class="light">Impel.inTouch.</span><b>options.displayName</b>

					</div>
					<div class="description">
						A human-friendly name for the database


					</div>







							<dl class="detailList">
							<dt class="heading">Default Value:</dt>
							<dd>
								Impel inTouch
							</dd>
							</dl>


					<hr />

					<a name=".options.maxSize"> </a>
					<div class="fixedFont">&lt;static&gt;

					<span class="light">{Number}</span>
					<span class="light">Impel.inTouch.</span><b>options.maxSize</b>

					</div>
					<div class="description">
						The maximum size that this database can grow to


					</div>







							<dl class="detailList">
							<dt class="heading">Default Value:</dt>
							<dd>
								4096
							</dd>
							</dl>


					<hr />

					<a name=".options.name"> </a>
					<div class="fixedFont">&lt;static&gt;

					<span class="light">{String}</span>
					<span class="light">Impel.inTouch.</span><b>options.name</b>

					</div>
					<div class="description">
						The name of the local database to use


					</div>







							<dl class="detailList">
							<dt class="heading">Default Value:</dt>
							<dd>
								Impel_inTouch
							</dd>
							</dl>


					<hr />

					<a name=".options.tableFileSuffix"> </a>
					<div class="fixedFont">&lt;static&gt;

					<span class="light">{String}</span>
					<span class="light">Impel.inTouch.</span><b>options.tableFileSuffix</b>

					</div>
					<div class="description">
						The suffix of the files on the server that include the import/update data


					</div>







							<dl class="detailList">
							<dt class="heading">Default Value:</dt>
							<dd>
								.json.php
							</dd>
							</dl>


					<hr />

					<a name=".options.versionsFile"> </a>
					<div class="fixedFont">&lt;static&gt;

					<span class="light">{String}</span>
					<span class="light">Impel.inTouch.</span><b>options.versionsFile</b>

					</div>
					<div class="description">
						The name of the file on the server that details the currently published tables and their versions


					</div>







							<dl class="detailList">
							<dt class="heading">Default Value:</dt>
							<dd>
								versions.json.php
							</dd>
							</dl>






<!-- ============================== method details ========================= -->

				<div class="sectionTitle">
					Method Detail
				</div>

					<a name="checkForUpdates"> </a>
					<div class="fixedFont">


					<b>checkForUpdates</b>(table_versions)

					</div>
					<div class="description">
						Check the server to see if the tables have been updated recently and call synchronize for any that have been updated.
<p>If this method is called with no arguments it asynchronously retrieves a list of the tables and their current versions.
When the list comes back this method is called again with that list as an argument. It then goes through the list
checking for tables that have a version number greater than their local counterparts. Synchronize is then called for
any tables that need to be updated.</p>


					</div>



					<pre class="code"> [
   { "table" : "card", "version": 3 },
   { "table" : "player", "versions" : [1,2,3,4,5,6] }
 ]</pre>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{Object[]}</span> <b>table_versions</b>
									<i>Optional</i>
								</dt>
								<dd>- A list of objects describing the current version, or all versions, of each published table</dd>

							</dl>








					<hr />

					<a name="getVersion"> </a>
					<div class="fixedFont">

					<span class="light">{Number}</span>
					<b>getVersion</b>(table)

					</div>
					<div class="description">
						Determine which version a particular local table is currently at. The server will NOT be queried.
<p><strong>Important Note</strong>: This method should not be called before the 'ready' event has been fired. </p>


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{String}</span> <b>table</b>

								</dt>
								<dd>The name of the table to check</dd>

							</dl>





							<dl class="detailList">
							<dt class="heading">Returns:</dt>

								<dd><span class="light fixedFont">{Number}</span> The current version number for the specified table</dd>

							</dl>




					<hr />

					<a name="importData"> </a>
					<div class="fixedFont">


					<b>importData</b>(data)

					</div>
					<div class="description">
						Import a new version of a table into the local database.
<p>If any portion of the import fails the entire transaction is rolled back.</p>


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{Object}</span> <b>data</b>

								</dt>
								<dd>- An Object containing the following keys:
<li><span class="type">{String}</span> <span class="param">table</span> The name of the table</li>
<li><span class="type">{Int}</span> <span class="param">version</span> The version of table and its data</li>
<li><span class="type">{String[]}</span> [<span class="param">pre-create</span>] An array of SQL statements to execute before going on to the create string</li>
<li><span class="type">{String}</span> [<span class="param">create</span>] An SQL statement used to create the table</li>
<li><span class="type">{String[]}</span> [<span class="param">extra</span>] An array of SQL statements used to modify the table after it has been created, but before data has been loaded</li>
<li><span class="type">{String[]}</span> [<span class="param">data</span>] Array of INSERT, UPDATE, or DELETE statements used to fill the table</li></dd>

							</dl>








					<hr />

					<a name="loadVersions"> </a>
					<div class="fixedFont">


					<b>loadVersions</b>(s_callback)

					</div>
					<div class="description">
						Check the local database to determine the current versions of all local tables. The version information will be stored in memory to serve future requests to <a href="#getVersion">getVersion</a>


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{function}</span> <b>s_callback</b>

								</dt>
								<dd>A function to call when the load is complete</dd>

							</dl>







							<dl class="detailList">
							<dt class="heading">See:</dt>

								<dd><a href="../symbols/Impel.inTouch.html#getVersion">Impel.inTouch#getVersion</a></dd>

								<dd><a href="../symbols/Impel.inTouch.html#setVersion">Impel.inTouch#setVersion</a></dd>

							</dl>


					<hr />

					<a name="setVersion"> </a>
					<div class="fixedFont">


					<b>setVersion</b>(table, version)

					</div>
					<div class="description">
						Record that a particular table is at a particular version, and persist the record into the database.
<p><strong>Important Note</strong>: This method should not be called before the 'ready' event has been fired. </p>


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{String}</span> <b>table</b>

								</dt>
								<dd>The name of the table</dd>

								<dt>
									<span class="light fixedFont">{Int}</span> <b>version</b>

								</dt>
								<dd>The, now, current version for the table</dd>

							</dl>








					<hr />

					<a name="sync"> </a>
					<div class="fixedFont">


					<b>sync</b>(list)

					</div>
					<div class="description">
						Synchronize the local tables with those published by the server.
<p>If this method is called with no arguments it calls <a href="#checkForUpdates">checkForUpdates</a>, which will in turn call this method with a list
of tables that need to be synchronized. Synchronize then asynchronously retrieves the update data from the server,
which will be inserted into the local database via importData</p>

<p>Tables can be updated in one of two ways:</p>
 <ol>
   <li>Single Update: no matter what the current version of the table is it will be updated to the absolute latest version.</li>
   <li>Incremental Update: the table will be updated to the next most recent version then the next most recent, and so on until it is at the latest version.</li>
 </ol>

<p>If you want a table to be updated in a single request then setup your versions file with a "version" : latest_version_number attribute for the table. Then define the latest table version in a single file named [table_name].json.php (the suffix is configurable).</p>
<p>If you want the table to be updated incrementally remove the "version" key from the tables entry in the versions file and replace it with a "versions" : array_of_all_versions attribute for the table. Then define a table definition file for each version. The files must be named: [table_name]_[version_number].json.php (the suffix is configurable).</p>

<p>Once all tables have been updated the synced or syncFailed event will be fired.</p>

<p><strong>Important Note</strong>: This method should not be called before the 'ready' event has been fired. </p>


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{String|Object[]}</span> <b>list</b>
									<i>Optional</i>
								</dt>
								<dd>- A list of tables that need to be updated. If null then it will check the server's published versions file. A table can be either a String, or an object that contains the following key/value  pairs:
   <ul>
     <li> <span class="type">{String}</span> <span class="param">table</span> The name of the table to update in a single request</li>
     <li> <span class="type">{Array}</span> <span class="param">versions</span> An ordered list of all the versions between the table's current version + 1 and the most recent version. </li>
   </ul></dd>

							</dl>












<!-- ============================== event details ========================= -->

				<div class="sectionTitle">
					Event Detail
				</div>

					<a name="event:onAborted"> </a>
					<div class="fixedFont">


					<b>onAborted</b>(code)

					</div>
					<div class="description">
						The sync was aborted due to a network error
 <ul>
   <lh>Codes</lh>
   <li>1 : The versions file could not be retrieved. </li>
 </ul>


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{Number}</span> <b>code</b>

								</dt>
								<dd></dd>

							</dl>








					<hr />

					<a name="event:onCreated"> </a>
					<div class="fixedFont">


					<b>onCreated</b>(table)

					</div>
					<div class="description">
						The portion of the update meant to create the local table succeeded


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{String}</span> <b>table</b>

								</dt>
								<dd></dd>

							</dl>








					<hr />

					<a name="event:onCreateFailed"> </a>
					<div class="fixedFont">


					<b>onCreateFailed</b>(table, error)

					</div>
					<div class="description">
						The portion of the update meant to create the local table failed


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{String}</span> <b>table</b>

								</dt>
								<dd></dd>

								<dt>
									<span class="light fixedFont">{String}</span> <b>error</b>

								</dt>
								<dd>The error message</dd>

							</dl>








					<hr />

					<a name="event:onReady"> </a>
					<div class="fixedFont">


					<b>onReady</b>()

					</div>
					<div class="description">
						The Impel.inTouch object has been initialized, you can now call sync or any other method.


					</div>











					<hr />

					<a name="event:onSynced"> </a>
					<div class="fixedFont">


					<b>onSynced</b>()

					</div>
					<div class="description">
						The local database has been fully synchronized with the server


					</div>











					<hr />

					<a name="event:onSyncFailed"> </a>
					<div class="fixedFont">


					<b>onSyncFailed</b>(failed)

					</div>
					<div class="description">
						One or more of the local tables was not synchronized with the server


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{String[]}</span> <b>failed</b>

								</dt>
								<dd>The tables that were not synchronized successfully</dd>

							</dl>








					<hr />

					<a name="event:onSyncing"> </a>
					<div class="fixedFont">


					<b>onSyncing</b>()

					</div>
					<div class="description">
						Synchronization has begun


					</div>











					<hr />

					<a name="event:onUpdated"> </a>
					<div class="fixedFont">


					<b>onUpdated</b>(table, old, now)

					</div>
					<div class="description">
						A particular table has been updated


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{String}</span> <b>table</b>

								</dt>
								<dd></dd>

								<dt>
									<span class="light fixedFont">{Number}</span> <b>old</b>

								</dt>
								<dd>The table was at old version</dd>

								<dt>
									<span class="light fixedFont">{Number}</span> <b>now</b>

								</dt>
								<dd>The table is now at now version</dd>

							</dl>








					<hr />

					<a name="event:onUpdateFailed"> </a>
					<div class="fixedFont">


					<b>onUpdateFailed</b>(table, now, future)

					</div>
					<div class="description">
						A particular table was not updated


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{String}</span> <b>table</b>

								</dt>
								<dd></dd>

								<dt>
									<span class="light fixedFont">{Number}</span> <b>now</b>

								</dt>
								<dd>The table remains at now version</dd>

								<dt>
									<span class="light fixedFont">{Number}</span> <b>future</b>

								</dt>
								<dd>The table was not updated to future version</dd>

							</dl>








					<hr />

					<a name="event:onUpdating"> </a>
					<div class="fixedFont">


					<b>onUpdating</b>(table)

					</div>
					<div class="description">
						A particular table is now being updated


					</div>




							<dl class="detailList">
							<dt class="heading">Parameters:</dt>

								<dt>
									<span class="light fixedFont">{String}</span> <b>table</b>

								</dt>
								<dd></dd>

							</dl>












			<hr />
		</div>


<!-- ============================== footer ================================= -->
		<div class="fineprint" style="clear:both">

			Documentation generated by <a href="http://www.jsdoctoolkit.org/" target="_blank">JsDoc Toolkit</a> 2.1.0 on Sat May 09 2009 17:21:48 GMT+0900 (JST)
		</div>
	</body>
</html>
